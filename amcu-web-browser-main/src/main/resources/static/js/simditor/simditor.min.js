(function(t,a){'function'==typeof define&&define.amd?define('simditor',['jquery','simple-module','simple-hotkeys','simple-uploader'],function(d,s,u,h){return t.Simditor=a(d,s,u,h)}):'object'==typeof exports?module.exports=a(require('jquery'),require('simple-module'),require('simple-hotkeys'),require('simple-uploader')):t.Simditor=a(jQuery,SimpleModule,simple.hotkeys,simple.uploader)})(this,function(t,a,d,s){let u=828,h=868;(function(de,se){de.alert=function(ce,ue,ge){ce=ce||'\u786E\u5B9A\u5220\u9664\uFF1F',ue=ue||3e3,ge=ge||'10%';let he=se.getElementsByTagName('body')[0],me=se.createElement('div');me.style.backgroundColor='red',me.style.color=' #fff',me.style.position=' fixed',me.style.zIndex=9999999,me.style.height=' 60px',me.style.top=ge,me.style.left='50%',me.style.lineHeight=' 60px',me.style.borderRadius=' 4px',me.style.fontSize=' 20px',me.style.textAlign='center',me.style.padding='0 10px',me.className='animated  bounceInDown',me.id='alert',me.innerHTML=ce,he.appendChild(me);let fe=se.getElementById('alert'),ye=de.getComputedStyle(fe,null).width;me.style.marginLeft=-parseInt(ye)/2+'px',setTimeout(function(){he.removeChild(me)},ue)}})(window,document);let f,y,_,v,w,C,T,N,S,A,E,B,R,I,O,P,M,z,L,W,D,H,U,V,F,K,X,J,Q,G,Y,Z,ee,te,oe=function(de,se){function pe(){this.constructor=de}for(let ce in se)ae.call(se,ce)&&(de[ce]=se[ce]);return pe.prototype=se.prototype,de.prototype=new pe,de.__super__=se.prototype,de},ae={}.hasOwnProperty,ne=[].indexOf||function(de){for(let se=0,pe=this.length;se<pe;se++)if(se in this&&this[se]===de)return se;return-1},le=[].slice;return F=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.pluginName='Selection',se.prototype._range=null,se.prototype._startNodes=null,se.prototype._endNodes=null,se.prototype._containerNode=null,se.prototype._nodes=null,se.prototype._blockNodes=null,se.prototype._rootNodes=null,se.prototype._init=function(){return this.editor=this._module,this._selection=document.getSelection(),this.editor.on('selectionchanged',function(pe){return function(){return pe.reset(),pe._range=pe._selection.getRangeAt(0)}}(this)),this.editor.on('blur',function(pe){return function(){return pe.reset()}}(this)),this.editor.on('focus',function(pe){return function(){return pe.reset(),pe._range=pe._selection.getRangeAt(0)}}(this))},se.prototype.reset=function(){return this._range=null,this._startNodes=null,this._endNodes=null,this._containerNode=null,this._nodes=null,this._blockNodes=null,this._rootNodes=null},se.prototype.clear=function(){try{this._selection.removeAllRanges()}catch(ce){}return this.reset()},se.prototype.range=function(pe){let ce;return pe?(this.clear(),this._selection.addRange(pe),this._range=pe,ce=this.editor.util.browser.firefox||this.editor.util.browser.msie,!this.editor.inputManager.focused&&ce&&this.editor.body.focus()):!this._range&&this.editor.inputManager.focused&&this._selection.rangeCount&&(this._range=this._selection.getRangeAt(0)),this._range},se.prototype.startNodes=function(){return this._range&&(this._startNodes||(this._startNodes=function(pe){return function(){let ce;return ce=t(pe._range.startContainer).parentsUntil(pe.editor.body).get(),ce.unshift(pe._range.startContainer),t(ce)}}(this)())),this._startNodes},se.prototype.endNodes=function(){let pe;return this._range&&(this._endNodes||(this._endNodes=this._range.collapsed?this.startNodes():(pe=t(this._range.endContainer).parentsUntil(this.editor.body).get(),pe.unshift(this._range.endContainer),t(pe)))),this._endNodes},se.prototype.containerNode=function(){return this._range&&(this._containerNode||(this._containerNode=t(this._range.commonAncestorContainer))),this._containerNode},se.prototype.nodes=function(){return this._range&&(this._nodes||(this._nodes=function(pe){return function(){let ce;return ce=[],pe.startNodes().first().is(pe.endNodes().first())?ce=pe.startNodes().get():(pe.startNodes().each(function(ue,ge){let he,me,fe,ye,_e,be,ve;return me=t(ge),-1<pe.endNodes().index(me)?ce.push(ge):me.parent().is(pe.editor.body)||-1<(be=pe.endNodes().index(me.parent()))?(he=be&&-1<be?pe.endNodes().eq(be-1):pe.endNodes().last(),fe=me.parent().contents(),ve=fe.index(me),ye=fe.index(he),t.merge(ce,fe.slice(ve,ye).get())):(fe=me.parent().contents(),_e=fe.index(me),t.merge(ce,fe.slice(_e).get()))}),pe.endNodes().each(function(ue,ge){let he,me,fe;return he=t(ge),he.parent().is(pe.editor.body)||-1<pe.startNodes().index(he.parent())?(ce.push(ge),!1):(me=he.parent().contents(),fe=me.index(he),t.merge(ce,me.slice(0,fe+1)))})),t(t.unique(ce))}}(this)())),this._nodes},se.prototype.blockNodes=function(){if(this._range)return this._blockNodes||(this._blockNodes=function(pe){return function(){return pe.nodes().filter(function(ce,ue){return pe.editor.util.isBlockNode(ue)})}}(this)()),this._blockNodes},se.prototype.rootNodes=function(){if(this._range)return this._rootNodes||(this._rootNodes=function(pe){return function(){return pe.nodes().filter(function(ce,ue){let ge;return ge=t(ue).parent(),ge.is(pe.editor.body)||ge.is('blockquote')})}}(this)()),this._rootNodes},se.prototype.rangeAtEndOf=function(pe,ce){let ue,ge,he,me,fe,ye;if(null==ce&&(ce=this.range()),!!(ce&&ce.collapsed))return(pe=t(pe)[0],he=ce.endContainer,me=this.editor.util.getNodeLength(he),ge=ce.endOffset===me-1,fe=t(he).contents().last().is('br'),ue=ce.endOffset===me,!!(ge&&fe||ue))&&(pe===he||!!t.contains(pe,he)&&(ye=!0,t(he).parentsUntil(pe).addBack().each(function(_e,be){let ve,we,xe,ke;if(ke=t(be).parent().contents().filter(function(){return this===be||3!==this.nodeType||this.nodeValue}),ve=ke.last(),xe=ve.get(0)===be,we=ve.is('br')&&ve.prev().get(0)===be,!(xe||we))return ye=!1,!1}),ye))},se.prototype.rangeAtStartOf=function(pe,ce){let ue,ge;if(null==ce&&(ce=this.range()),!!(ce&&ce.collapsed))return(pe=t(pe)[0],ge=ce.startContainer,0===ce.startOffset)&&(pe===ge||!!t.contains(pe,ge)&&(ue=!0,t(ge).parentsUntil(pe).addBack().each(function(he,me){let fe;if(fe=t(me).parent().contents().filter(function(){return this===me||3!==this.nodeType||this.nodeValue}),fe.first().get(0)!==me)return ue=!1}),ue))},se.prototype.insertNode=function(pe,ce){if(null==ce&&(ce=this.range()),!!ce)return pe=t(pe)[0],ce.insertNode(pe),this.setRangeAfter(pe,ce)},se.prototype.setRangeAfter=function(pe,ce){if(null==ce&&(ce=this.range()),null!=ce)return pe=t(pe)[0],ce.setEndAfter(pe),ce.collapse(!1),this.range(ce)},se.prototype.setRangeBefore=function(pe,ce){if(null==ce&&(ce=this.range()),null!=ce)return pe=t(pe)[0],ce.setEndBefore(pe),ce.collapse(!1),this.range(ce)},se.prototype.setRangeAtStartOf=function(pe,ce){return null==ce&&(ce=this.range()),pe=t(pe).get(0),ce.setEnd(pe,0),ce.collapse(!1),this.range(ce)},se.prototype.setRangeAtEndOf=function(pe,ce){let ue,ge,he,me,fe,ye,_e;if(null==ce&&(ce=this.range()),ge=t(pe),pe=ge[0],!!pe)return ge.is('pre')?(he=ge.contents(),0<he.length?(me=he.last(),ye=me.text(),fe=this.editor.util.getNodeLength(me[0]),'\n'===ye.charAt(ye.length-1)?ce.setEnd(me[0],fe-1):ce.setEnd(me[0],fe)):ce.setEnd(pe,0)):(_e=this.editor.util.getNodeLength(pe),3!==pe.nodeType&&0<_e&&(ue=t(pe).contents().last(),ue.is('br')?_e-=1:3!==ue[0].nodeType&&this.editor.util.isEmptyNode(ue)&&(ue.append(this.editor.util.phBr),pe=ue[0],_e=0)),ce.setEnd(pe,_e)),ce.collapse(!1),this.range(ce)},se.prototype.deleteRangeContents=function(pe){let ce,ue,ge,he;return null==pe&&(pe=this.range()),he=pe.cloneRange(),ge=pe.cloneRange(),he.collapse(!0),ge.collapse(!1),ue=this.rangeAtStartOf(this.editor.body,he),ce=this.rangeAtEndOf(this.editor.body,ge),!pe.collapsed&&ue&&ce?(this.editor.body.empty(),pe.setStart(this.editor.body[0],0),pe.collapse(!0),this.range(pe)):pe.deleteContents(),pe},se.prototype.breakBlockEl=function(pe,ce){let ue;return(null==ce&&(ce=this.range()),ue=t(pe),!ce.collapsed)?ue:(ce.setStartBefore(ue.get(0)),ce.collapsed?ue:ue.before(ce.extractContents()))},se.prototype.save=function(pe){let ce,ue,ge;if(null==pe&&(pe=this.range()),!this._selectionSaved)return ue=pe.cloneRange(),ue.collapse(!1),ge=t('<span/>').addClass('simditor-caret-start'),ce=t('<span/>').addClass('simditor-caret-end'),ue.insertNode(ce[0]),pe.insertNode(ge[0]),this.clear(),this._selectionSaved=!0},se.prototype.restore=function(){let pe,ce,ue,ge,he,me,fe;return!!this._selectionSaved&&(he=this.editor.body.find('.simditor-caret-start'),pe=this.editor.body.find('.simditor-caret-end'),he.length&&pe.length?(me=he.parent(),fe=me.contents().index(he),ce=pe.parent(),ue=ce.contents().index(pe),me[0]===ce[0]&&(ue-=1),ge=document.createRange(),ge.setStart(me.get(0),fe),ge.setEnd(ce.get(0),ue),he.remove(),pe.remove(),this.range(ge)):(he.remove(),pe.remove()),this._selectionSaved=!1,ge)},se}(a),A=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.pluginName='Formatter',se.prototype.opts={allowedTags:[],allowedAttributes:{},allowedStyles:{}},se.prototype._init=function(){return this.editor=this._module,this._allowedTags=t.merge(['br','span','a','img','b','strong','i','strike','u','font','p','ul','ol','li','blockquote','pre','code','h1','h2','h3','h4','hr'],this.opts.allowedTags),this._allowedAttributes=t.extend({img:['src','alt','width','height','data-non-image'],a:['href','target'],font:['color'],code:['class']},this.opts.allowedAttributes),this._allowedStyles=t.extend({span:['color','font-size'],b:['color'],i:['color'],strong:['color'],strike:['color'],u:['color'],p:['margin-left','text-align'],h1:['margin-left','text-align'],h2:['margin-left','text-align'],h3:['margin-left','text-align'],h4:['margin-left','text-align']},this.opts.allowedStyles),this.editor.body.on('click','a',function(){return!1})},se.prototype.decorate=function(pe){return null==pe&&(pe=this.editor.body),this.editor.trigger('decorate',[pe]),pe},se.prototype.undecorate=function(pe){return null==pe&&(pe=this.editor.body.clone()),this.editor.trigger('undecorate',[pe]),pe},se.prototype.autolink=function(pe){let ce,ue,ge,he,me,fe,ye,_e,be,ve,we,xe,ke;for(null==pe&&(pe=this.editor.body),ye=[],ge=function(Ce){return Ce.contents().each(function(Te,Ne){let Se,Ae;if(Se=t(Ne),!(Se.is('a')||Se.closest('a, pre',pe).length))return!Se.is('iframe')&&Se.contents().length?ge(Se):(Ae=Se.text())&&/https?:\/\/|www\./ig.test(Ae)?ye.push(Se):void 0})},ge(pe),be=/(https?:\/\/|www\.)[\w\-\.\?&=\/#%:,@\!\+]+/ig,(he=0,fe=ye.length);he<fe;he++){for(ue=ye[he],xe=ue.text(),ve=[],_e=null,me=0;null!==(_e=be.exec(xe));)we=xe.substring(me,_e.index),ve.push(document.createTextNode(we)),me=be.lastIndex,ke=/^(http(s)?:\/\/|\/)/.test(_e[0])?_e[0]:'http://'+_e[0],ce=t('<a href="'+ke+'" rel="nofollow"></a>').text(_e[0]),ve.push(ce[0]);ve.push(document.createTextNode(xe.substring(me))),ue.replaceWith(t(ve))}return pe},se.prototype.format=function(pe){let ce,ue,ge,he,me,fe,ye,_e,be,ve;if(null==pe&&(pe=this.editor.body),pe.is(':empty'))return pe.append('<p>'+this.editor.util.phBr+'</p>'),pe;for(be=pe.contents(),ge=0,me=be.length;ge<me;ge++)ye=be[ge],this.cleanNode(ye,!0);for(ve=pe.contents(),he=0,fe=ve.length;he<fe;he++)_e=ve[he],ce=t(_e),ce.is('br')?('undefined'!=typeof ue&&null!==ue&&(ue=null),ce.remove()):this.editor.util.isBlockNode(_e)?ce.is('li')?ue&&ue.is('ul, ol')?ue.append(_e):(ue=t('<ul/>').insertBefore(_e),ue.append(_e)):ue=null:((!ue||ue.is('ul, ol'))&&(ue=t('<p/>').insertBefore(_e)),ue.append(_e),this.editor.util.isEmptyNode(ue)&&ue.append(this.editor.util.phBr));return pe},se.prototype.cleanNode=function(pe,ce){let ue,ge,he,me,fe,ye,_e,be,ve,we,xe,ke,Ce,Te,Ne,Se,Ae,Ee;if(he=t(pe),!!(0<he.length)){if(3===he[0].nodeType)return Ae=he.text().replace(/(\r\n|\n|\r)/gm,''),void(Ae?(Ee=document.createTextNode(Ae),he.replaceWith(Ee)):he.remove());if(be=he.is('iframe')?null:he.contents(),ve=this.editor.util.isDecoratedNode(he),!(he.is(this._allowedTags.join(','))||ve))1!==he[0].nodeType||he.is(':empty')?(he.remove(),be=null):he.is('div, article, dl, header, footer, tr')?(he.append('<br/>'),be.first().unwrap()):he.is('table')?(me=t('<p/>'),he.find('tr').each(function(Be,Re){return me.append(t(Re).text()+'<br/>')}),he.replaceWith(me),be=null):he.is('thead, tfoot')?(he.remove(),be=null):he.is('th')?(fe=t('<td/>').append(he.contents()),he.replaceWith(fe)):be.first().unwrap();else if(he.is('a')&&0<(ge=he.find('img')).length&&(he.replaceWith(ge),he=ge,be=null),he.is('td')&&0<(ue=he.find(this.editor.util.blockNodes.join(','))).length&&(ue.each(function(){return function(Re,Ie){return t(Ie).contents().unwrap()}}(this)),be=he.contents()),he.is('img')&&he.hasClass('uploading')&&he.remove(),!ve){for(ye=this._allowedAttributes[he[0].tagName.toLowerCase()],Ne=t.makeArray(he[0].attributes),(we=0,ke=Ne.length);we<ke;we++)(_e=Ne[we],'style'!==_e.name)&&(null!=ye&&(Se=_e.name,0<=ne.call(ye,Se))||he.removeAttr(_e.name));this._cleanNodeStyles(he),he.is('span')&&(0===he[0].attributes.length&&he.contents().first().unwrap(),2===he[0].style.length&&'rgb(51, 51, 51)'===he[0].style.color&&'16px'===he[0].style.fontSize&&he.contents().unwrap())}if(ce&&null!=be&&!he.is('pre'))for(xe=0,Ce=be.length;xe<Ce;xe++)Te=be[xe],this.cleanNode(Te,!0);return null}},se.prototype._cleanNodeStyles=function(pe){let ce,ue,ge,he,me,fe,ye,_e,be;if(_e=pe.attr('style'),!!_e){if(pe.removeAttr('style'),ce=this._allowedStyles[pe[0].tagName.toLowerCase()],!(ce&&0<ce.length))return pe;for(be={},me=_e.split(';'),(ue=0,ge=me.length);ue<ge;ue++)(ye=me[ue],ye=t.trim(ye),he=ye.split(':'),2===he.length)&&('font-size'===he[0]&&0<he[1].indexOf('px')&&12>parseInt(he[1],10)||(fe=he[0],0<=ne.call(ce,fe))&&(be[t.trim(he[0])]=t.trim(he[1])));return 0<Object.keys(be).length&&pe.css(be),pe}},se.prototype.clearHtml=function(pe,ce){let ue,ge,he;return null==ce&&(ce=!0),ue=t('<div/>').append(pe),ge=ue.contents(),he='',ge.each(function(me){return function(fe,ye){let _e,be;return 3===ye.nodeType?he+=ye.nodeValue:1===ye.nodeType&&(_e=t(ye),be=_e.is('iframe')?null:_e.contents(),be&&0<be.length&&(he+=me.clearHtml(be)),ce&&fe<ge.length-1&&_e.is('br, p, div, li,tr, pre, address, artticle, aside, dl, figcaption, footer, h1, h2,h3, h4, header'))?he+='\n':void 0}}(this)),he},se.prototype.beautify=function(pe){let ce;return ce=function(ue){return!!(ue.is('p')&&!ue.text()&&1>ue.children(':not(br)').length)},pe.each(function(ue,ge){let he,me;return he=t(ge),me=he.is(':not(img, br, col, td, hr, [class^="simditor-"]):empty'),(me||ce(he))&&he.remove(),he.find(':not(img, br, col, td, hr, [class^="simditor-"]):empty').remove()})},se}(a),P=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.pluginName='InputManager',se.prototype._modifierKeys=[16,17,18,91,93,224],se.prototype._arrowKeys=[37,38,39,40],se.prototype._init=function(){let pe,ce;return this.editor=this._module,this.throttledValueChanged=this.editor.util.throttle(function(ue){return function(ge){return setTimeout(function(){return ue.editor.trigger('valuechanged',ge)},10)}}(this),300),this.throttledSelectionChanged=this.editor.util.throttle(function(ue){return function(){return ue.editor.trigger('selectionchanged')}}(this),50),t(document).on('selectionchange.simditor'+this.editor.id,function(ue){return function(){let he;if(ue.focused&&!ue.editor.clipboard.pasting)return he=function(){return ue._selectionTimer&&(clearTimeout(ue._selectionTimer),ue._selectionTimer=null),0<ue.editor.selection._selection.rangeCount?ue.throttledSelectionChanged():ue._selectionTimer=setTimeout(function(){if(ue._selectionTimer=null,ue.focused)return he()},10)},he()}}(this)),this.editor.on('valuechanged',function(ue){return function(){let ge;if(ue.lastCaretPosition=null,ge=ue.editor.body.children().filter(function(he,me){return ue.editor.util.isBlockNode(me)}),ue.focused&&0===ge.length&&(ue.editor.selection.save(),ue.editor.formatter.format(),ue.editor.selection.restore()),ue.editor.body.find('hr, pre, .simditor-table').each(function(he,me){let fe,ye;if(fe=t(me),(fe.parent().is('blockquote')||fe.parent()[0]===ue.editor.body[0])&&(ye=!1,0===fe.next().length&&(t('<p/>').append(ue.editor.util.phBr).insertAfter(fe),ye=!0),0===fe.prev().length&&(t('<p/>').append(ue.editor.util.phBr).insertBefore(fe),ye=!0),ye))return ue.throttledValueChanged()}),ue.editor.body.find('pre:empty').append(ue.editor.util.phBr),!ue.editor.util.support.onselectionchange&&ue.focused)return ue.throttledSelectionChanged()}}(this)),this.editor.body.on('keydown',t.proxy(this._onKeyDown,this)).on('keypress',t.proxy(this._onKeyPress,this)).on('keyup',t.proxy(this._onKeyUp,this)).on('mouseup',t.proxy(this._onMouseUp,this)).on('focus',t.proxy(this._onFocus,this)).on('blur',t.proxy(this._onBlur,this)).on('drop',t.proxy(this._onDrop,this)).on('input',t.proxy(this._onInput,this)),this.editor.util.browser.firefox&&(this.editor.hotkeys.add('cmd+left',function(ue){return function(ge){return ge.preventDefault(),ue.editor.selection._selection.modify('move','backward','lineboundary'),!1}}(this)),this.editor.hotkeys.add('cmd+right',function(ue){return function(ge){return ge.preventDefault(),ue.editor.selection._selection.modify('move','forward','lineboundary'),!1}}(this)),pe=this.editor.util.os.mac?'cmd+a':'ctrl+a',this.editor.hotkeys.add(pe,function(ue){return function(){let he,me,fe,ye;if(he=ue.editor.body.children(),!!(0<he.length))return me=he.first().get(0),fe=he.last().get(0),ye=document.createRange(),ye.setStart(me,0),ye.setEnd(fe,ue.editor.util.getNodeLength(fe)),ue.editor.selection.range(ye),!1}}(this))),ce=this.editor.util.os.mac?'cmd+enter':'ctrl+enter',this.editor.hotkeys.add(ce,function(ue){return function(){return ue.editor.el.closest('form').find('button:submit').click(),!1}}(this))},se.prototype._onFocus=function(){if(!this.editor.clipboard.pasting)return this.editor.el.addClass('focus').removeClass('error'),this.focused=!0,setTimeout(function(ce){return function(){let ue,ge;if(ge=ce.editor.selection._selection.getRangeAt(0),ge.startContainer===ce.editor.body[0]&&(ce.lastCaretPosition?ce.editor.undoManager.caretPosition(ce.lastCaretPosition):(ue=ce.editor.body.children().first(),ge=document.createRange(),ce.editor.selection.setRangeAtStartOf(ue,ge))),ce.lastCaretPosition=null,ce.editor.triggerHandler('focus'),!ce.editor.util.support.onselectionchange)return ce.throttledSelectionChanged()}}(this),0)},se.prototype._onBlur=function(){let ce;if(!this.editor.clipboard.pasting)return this.editor.el.removeClass('focus'),this.editor.sync(),this.focused=!1,this.lastCaretPosition=null==(ce=this.editor.undoManager.currentState())?void 0:ce.caret,this.editor.triggerHandler('blur')},se.prototype._onMouseUp=function(){if(!this.editor.util.support.onselectionchange)return this.throttledSelectionChanged()},se.prototype._onKeyDown=function(pe){let ce,ue;return!1!==this.editor.triggerHandler(pe)&&(this.editor.hotkeys.respondTo(pe)?void 0:this.editor.keystroke.respondTo(pe)?(this.throttledValueChanged(),!1):(ce=pe.which,0<=ne.call(this._modifierKeys,ce))||(ue=pe.which,0<=ne.call(this._arrowKeys,ue))||this.editor.util.metaKey(pe)&&86===pe.which?void 0:(this.editor.util.support.oninput||this.throttledValueChanged(['typing']),null))},se.prototype._onKeyPress=function(pe){if(!1===this.editor.triggerHandler(pe))return!1},se.prototype._onKeyUp=function(pe){let ce,ue;return!1!==this.editor.triggerHandler(pe)&&(!this.editor.util.support.onselectionchange&&(ue=pe.which,0<=ne.call(this._arrowKeys,ue))?void this.throttledValueChanged():void((8===pe.which||46===pe.which)&&this.editor.util.isEmptyNode(this.editor.body)&&(this.editor.body.empty(),ce=t('<p/>').append(this.editor.util.phBr).appendTo(this.editor.body),this.editor.selection.setRangeAtStartOf(ce))))},se.prototype._onDrop=function(pe){return!1!==this.editor.triggerHandler(pe)&&this.throttledValueChanged()},se.prototype._onInput=function(){return this.throttledValueChanged(['oninput'])},se}(a),z=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.pluginName='Keystroke',se.prototype._init=function(){return this.editor=this._module,this._keystrokeHandlers={},this._initKeystrokeHandlers()},se.prototype.add=function(pe,ce,ue){return pe=pe.toLowerCase(),pe=this.editor.hotkeys.constructor.aliases[pe]||pe,this._keystrokeHandlers[pe]||(this._keystrokeHandlers[pe]={}),this._keystrokeHandlers[pe][ce]=ue},se.prototype.respondTo=function(pe){let ce,ue,ge,he;return ue=null==(ge=this.editor.hotkeys.constructor.keyNameMap[pe.which])?void 0:ge.toLowerCase(),ue?ue in this._keystrokeHandlers&&(he='function'==typeof(ce=this._keystrokeHandlers[ue])['*']?ce['*'](pe):void 0,he||this.editor.selection.startNodes().each(function(me){return function(fe,ye){let _e,be;if(ye.nodeType===Node.ELEMENT_NODE&&(_e=null==(be=me._keystrokeHandlers[ue])?void 0:be[ye.tagName.toLowerCase()],he='function'==typeof _e?_e(pe,t(ye)):void 0,!0===he||!1===he))return!1}}(this)),he)||void 0:void 0},se.prototype._initKeystrokeHandlers=function(){let pe;return this.editor.util.browser.safari&&this.add('enter','*',function(ce){return function(ue){let ge,he;if(ue.shiftKey)return(ge=ce.editor.selection.blockNodes().last(),!ge.is('pre'))?(he=t('<br/>'),ce.editor.selection.rangeAtEndOf(ge)?(ce.editor.selection.insertNode(he),ce.editor.selection.insertNode(t('<br/>')),ce.editor.selection.setRangeBefore(he)):ce.editor.selection.insertNode(he),!0):void 0}}(this)),(this.editor.util.browser.webkit||this.editor.util.browser.msie)&&(pe=function(ce){return function(ue,ge){let he;if(ce.editor.selection.rangeAtEndOf(ge))return he=t('<p/>').append(ce.editor.util.phBr).insertAfter(ge),ce.editor.selection.setRangeAtStartOf(he),!0}}(this),this.add('enter','h1',pe),this.add('enter','h2',pe),this.add('enter','h3',pe),this.add('enter','h4',pe),this.add('enter','h5',pe),this.add('enter','h6',pe)),this.add('backspace','*',function(ce){return function(ue){let ge,he,me,fe;return(me=ce.editor.selection.rootNodes().first(),he=me.prev(),he.is('hr')&&ce.editor.selection.rangeAtStartOf(me))?(ce.editor.selection.save(),he.remove(),ce.editor.selection.restore(),!0):(ge=ce.editor.selection.blockNodes().last(),ge.is('.simditor-resize-handle')&&me.is('.simditor-table')&&(ue.preventDefault(),me.remove(),ce.editor.selection.setRangeAtEndOf(he)),he.is('.simditor-table')&&!ge.is('table')&&ce.editor.util.isEmptyNode(ge)&&(ue.preventDefault(),ge.remove(),ce.editor.selection.setRangeAtEndOf(he)),fe=ce.editor.util.browser.webkit,fe&&ce.editor.selection.rangeAtStartOf(ge))?(ce.editor.selection.save(),ce.editor.formatter.cleanNode(ge,!0),ce.editor.selection.restore(),null):void 0}}(this)),this.add('enter','div',function(ce){return function(ue,ge){let he,me;if(ge.is('.simditor-table')&&(he=ce.editor.selection.blockNodes().last(),he.is('.simditor-resize-handle')))return ue.preventDefault(),me=t('<p/>').append(ce.editor.util.phBr).insertAfter(ge),ce.editor.selection.setRangeAtStartOf(me)}}(this)),this.add('enter','li',function(ce){return function(ue,ge){let he,me,fe,ye;if(he=ge.clone(),he.find('ul, ol').remove(),!!(ce.editor.util.isEmptyNode(he)&&ge.is(ce.editor.selection.blockNodes().last()))){if(me=ge.parent(),0<ge.next('li').length){if(!ce.editor.util.isEmptyNode(ge))return;0<me.parent('li').length?(fe=t('<li/>').append(ce.editor.util.phBr).insertAfter(me.parent('li')),ye=t('<'+me[0].tagName+'/>').append(ge.nextAll('li')),fe.append(ye)):(fe=t('<p/>').append(ce.editor.util.phBr).insertAfter(me),ye=t('<'+me[0].tagName+'/>').append(ge.nextAll('li')),fe.after(ye))}else 0<me.parent('li').length?(fe=t('<li/>').insertAfter(me.parent('li')),0<ge.contents().length?fe.append(ge.contents()):fe.append(ce.editor.util.phBr)):(fe=t('<p/>').append(ce.editor.util.phBr).insertAfter(me),0<ge.children('ul, ol').length&&fe.after(ge.children('ul, ol')));return ge.prev('li').length?ge.remove():ge.prev('ul').length||ge.prev('ol').length?ge.remove():me.remove(),ce.editor.selection.setRangeAtStartOf(fe),!0}}}(this)),this.add('enter','pre',function(ce){return function(ue,ge){let he,me,fe;return(ue.preventDefault(),ue.shiftKey)?(he=t('<p/>').append(ce.editor.util.phBr).insertAfter(ge),ce.editor.selection.setRangeAtStartOf(he),!0):(fe=ce.editor.selection.range(),me=null,fe.deleteContents(),!ce.editor.util.browser.msie&&ce.editor.selection.rangeAtEndOf(ge)?(me=document.createTextNode('\n\n'),fe.insertNode(me),fe.setEnd(me,1)):(me=document.createTextNode('\n'),fe.insertNode(me),fe.setStartAfter(me)),fe.collapse(!1),ce.editor.selection.range(fe),!0)}}(this)),this.add('enter','blockquote',function(ce){return function(ue,ge){let he,me;if(he=ce.editor.selection.blockNodes().last(),!!(he.is('p')&&!he.next().length&&ce.editor.util.isEmptyNode(he)))return ge.after(he),me=document.createRange(),ce.editor.selection.setRangeAtStartOf(he,me),!0}}(this)),this.add('backspace','li',function(ce){return function(ue,ge){let he,me,fe,ye,_e,be,ve,we,xe;return(me=ge.children('ul, ol'),_e=ge.prev('li'),!!(0<me.length&&0<_e.length))&&((xe='',be=null,ge.contents().each(function(ke,Ce){return 1===Ce.nodeType&&/UL|OL/.test(Ce.nodeName)?!1:1===Ce.nodeType&&/BR/.test(Ce.nodeName)?void 0:(3===Ce.nodeType&&Ce.nodeValue?xe+=Ce.nodeValue:1===Ce.nodeType&&(xe+=t(Ce).text()),be=t(Ce))}),ve=ce.editor.util.browser.firefox&&!be.next('br').length,be&&1===xe.length&&ve)?(he=t(ce.editor.util.phBr).insertAfter(be),be.remove(),ce.editor.selection.setRangeBefore(he),!0):!(0<xe.length)&&(we=document.createRange(),ye=_e.children('ul, ol'),0<ye.length?(fe=t('<li/>').append(ce.editor.util.phBr).appendTo(ye),ye.append(me.children('li')),ge.remove(),ce.editor.selection.setRangeAtEndOf(fe,we)):(ce.editor.selection.setRangeAtEndOf(_e,we),_e.append(me),ge.remove(),ce.editor.selection.range(we)),!0))}}(this)),this.add('backspace','pre',function(ce){return function(ue,ge){let he,me,fe;if(ce.editor.selection.rangeAtStartOf(ge))return me=ge.html().replace('\n','<br/>')||ce.editor.util.phBr,he=t('<p/>').append(me).insertAfter(ge),ge.remove(),fe=document.createRange(),ce.editor.selection.setRangeAtStartOf(he,fe),!0}}(this)),this.add('backspace','blockquote',function(ce){return function(ue,ge){let he,me;if(ce.editor.selection.rangeAtStartOf(ge))return he=ge.children().first().unwrap(),me=document.createRange(),ce.editor.selection.setRangeAtStartOf(he,me),!0}}(this))},se}(a),Z=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.pluginName='UndoManager',se.prototype._index=-1,se.prototype._capacity=20,se.prototype._startPosition=null,se.prototype._endPosition=null,se.prototype._init=function(){let pe,ce;return this.editor=this._module,this._stack=[],this.editor.util.os.mac?(ce='cmd+z',pe='shift+cmd+z'):this.editor.util.os.win?(ce='ctrl+z',pe='ctrl+y'):(ce='ctrl+z',pe='shift+ctrl+z'),this.editor.hotkeys.add(ce,function(ue){return function(ge){return ge.preventDefault(),ue.undo(),!1}}(this)),this.editor.hotkeys.add(pe,function(ue){return function(ge){return ge.preventDefault(),ue.redo(),!1}}(this)),this.throttledPushState=this.editor.util.throttle(function(ue){return function(){return ue._pushUndoState()}}(this),2e3),this.editor.on('valuechanged',function(ue){return function(ge,he){return'undo'===he||'redo'===he?void 0:ue.throttledPushState()}}(this)),this.editor.on('selectionchanged',function(ue){return function(){return ue.resetCaretPosition(),ue.update()}}(this)),this.editor.on('focus',function(ue){return function(){if(0===ue._stack.length)return ue._pushUndoState()}}(this)),this.editor.on('blur',function(ue){return function(){return ue.resetCaretPosition()}}(this))},se.prototype.resetCaretPosition=function(){return this._startPosition=null,this._endPosition=null},se.prototype.startPosition=function(){return this.editor.selection._range&&(this._startPosition||(this._startPosition=this._getPosition('start'))),this._startPosition},se.prototype.endPosition=function(){return this.editor.selection._range&&(this._endPosition||(this._endPosition=function(pe){return function(){let ce;return ce=pe.editor.selection.range(),ce.collapsed?pe._startPosition:pe._getPosition('end')}}(this)())),this._endPosition},se.prototype._pushUndoState=function(){let pe;if(!1!==this.editor.triggerHandler('pushundostate'))return(pe=this.caretPosition(),!!pe.start)?(this._index+=1,this._stack.length=this._index,this._stack.push({html:this.editor.body.html(),caret:this.caretPosition()}),this._stack.length>this._capacity)?(this._stack.shift(),this._index-=1):void 0:void 0},se.prototype.currentState=function(){return this._stack.length&&-1<this._index?this._stack[this._index]:null},se.prototype.undo=function(){let pe;if(!(1>this._index||2>this._stack.length))return this.editor.hidePopover(),this._index-=1,pe=this._stack[this._index],this.editor.body.get(0).innerHTML=pe.html,this.caretPosition(pe.caret),this.editor.body.find('.selected').removeClass('selected'),this.editor.sync(),this.editor.trigger('valuechanged',['undo'])},se.prototype.redo=function(){let pe;if(!(0>this._index||this._stack.length<this._index+2))return this.editor.hidePopover(),this._index+=1,pe=this._stack[this._index],this.editor.body.get(0).innerHTML=pe.html,this.caretPosition(pe.caret),this.editor.body.find('.selected').removeClass('selected'),this.editor.sync(),this.editor.trigger('valuechanged',['redo'])},se.prototype.update=function(){let pe;if(pe=this.currentState(),!!pe)return pe.html=this.editor.body.html(),pe.caret=this.caretPosition()},se.prototype._getNodeOffset=function(pe,ce){let ue,ge,he;return ue=t.isNumeric(ce)?t(pe):t(pe).parent(),he=0,ge=!1,ue.contents().each(function(me,fe){return pe===fe||ce===me&&0===me?!1:(fe.nodeType===Node.TEXT_NODE?!ge&&0<fe.nodeValue.length&&(he+=1,ge=!0):(he+=1,ge=!1),ce-1!==me&&null)}),he},se.prototype._getPosition=function(pe){let ce,ue,ge,he,me,fe,ye;if(null==pe&&(pe='start'),ye=this.editor.selection.range(),he=ye[pe+'Offset'],ce=this.editor.selection[pe+'Nodes'](),ue=ce.first()[0],ue.nodeType===Node.TEXT_NODE){for(fe=ue.previousSibling;fe&&fe.nodeType===Node.TEXT_NODE;)ue=fe,he+=this.editor.util.getNodeLength(fe),fe=fe.previousSibling;ge=ce.get(),ge[0]=ue,ce=t(ge)}else he=this._getNodeOffset(ue,he);return me=[he],ce.each(function(_e){return function(be,ve){return me.unshift(_e._getNodeOffset(ve))}}(this)),me},se.prototype._getNodeByPosition=function(pe){let ce,ue,ge,he,me,fe,ye,_e;for(fe=this.editor.body[0],_e=pe.slice(0,pe.length-1),(ge=he=0,me=_e.length);he<me;ge=++he){if(ye=_e[ge],ue=fe.childNodes,ye>ue.length-1)if(ge===pe.length-2&&t(fe).is('pre:empty'))ce=document.createTextNode(''),fe.appendChild(ce),ue=fe.childNodes;else{fe=null;break}fe=ue[ye]}return fe},se.prototype.caretPosition=function(pe){let ce,ue,ge,he,me;return pe?pe.start?(he=this._getNodeByPosition(pe.start),me=pe.start[pe.start.length-1],pe.collapsed?(ce=he,ue=me):(ce=this._getNodeByPosition(pe.end),ue=pe.start[pe.start.length-1]),!he||!ce)?void('undefined'!=typeof console&&null!==console&&'function'==typeof console.warn&&console.warn('simditor: invalid caret state')):(ge=document.createRange(),ge.setStart(he,me),ge.setEnd(ce,ue),this.editor.selection.range(ge)):void 0:(ge=this.editor.selection.range(),pe=this.editor.inputManager.focused&&null!=ge?{start:this.startPosition(),end:this.endPosition(),collapsed:ge.collapsed}:{},pe)},se}(a),te=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.pluginName='Util',se.prototype._init=function(){if(this.editor=this._module,this.browser.msie&&11>this.browser.version)return this.phBr=''},se.prototype.phBr='<br/>',se.prototype.os=function(){let pe;return pe={},/Mac/.test(navigator.appVersion)?pe.mac=!0:/Linux/.test(navigator.appVersion)?pe.linux=!0:/Win/.test(navigator.appVersion)?pe.win=!0:/X11/.test(navigator.appVersion)&&(pe.unix=!0),/Mobi/.test(navigator.appVersion)&&(pe.mobile=!0),pe}(),se.prototype.browser=function(){let pe,ce,ue,ge,he,me,fe,ye,_e,be,ve;return ve=navigator.userAgent,ge=/(msie|trident)/i.test(ve),pe=/chrome|crios/i.test(ve),be=/safari/i.test(ve)&&!pe,ue=/firefox/i.test(ve),ce=/edge/i.test(ve),ge?{msie:!0,version:1*(null==(he=ve.match(/(msie |rv:)(\d+(\.\d+)?)/i))?void 0:he[2])}:ce?{edge:!0,webkit:!0,version:1*(null==(me=ve.match(/edge\/(\d+(\.\d+)?)/i))?void 0:me[1])}:pe?{webkit:!0,chrome:!0,version:1*(null==(fe=ve.match(/(?:chrome|crios)\/(\d+(\.\d+)?)/i))?void 0:fe[1])}:be?{webkit:!0,safari:!0,version:1*(null==(ye=ve.match(/version\/(\d+(\.\d+)?)/i))?void 0:ye[1])}:ue?{mozilla:!0,firefox:!0,version:1*(null==(_e=ve.match(/firefox\/(\d+(\.\d+)?)/i))?void 0:_e[1])}:{}}(),se.prototype.support=function(){return{onselectionchange:function(){let ce;if(ce=document.onselectionchange,void 0!=ce)try{return document.onselectionchange=0,null===document.onselectionchange}catch(ue){}finally{document.onselectionchange=ce}return!1}(),oninput:function(){return!/(msie|trident)/i.test(navigator.userAgent)}()}}(),se.prototype.reflow=function(pe){return null==pe&&(pe=document),t(pe)[0].offsetHeight},se.prototype.metaKey=function(pe){let ce;return ce=/Mac/.test(navigator.userAgent),ce?pe.metaKey:pe.ctrlKey},se.prototype.isEmptyNode=function(pe){let ce;return ce=t(pe),ce.is(':empty')||!ce.text()&&!ce.find(':not(br, span, div)').length},se.prototype.isDecoratedNode=function(pe){return t(pe).is('[class^="simditor-"]')},se.prototype.blockNodes=['div','p','ul','ol','li','blockquote','hr','pre','h1','h2','h3','h4','h5','table'],se.prototype.isBlockNode=function(pe){return pe=t(pe)[0],pe&&3!==pe.nodeType&&new RegExp('^('+this.blockNodes.join('|')+')$').test(pe.nodeName.toLowerCase())},se.prototype.getNodeLength=function(pe){switch(pe=t(pe)[0],pe.nodeType){case 7:case 10:return 0;case 3:case 8:return pe.length;default:return pe.childNodes.length;}},se.prototype.dataURLtoBlob=function(pe){let ce,ue,ge,he,me,fe,ye,_e,be,ve,we,xe,ke;if(ye=window.Blob&&function(){let Ce;try{return!!new Blob}catch(Te){return Ce=Te,!1}}(),fe=ye&&window.Uint8Array&&function(){let Ce;try{return 100===new Blob([new Uint8Array(100)]).size}catch(Te){return Ce=Te,!1}}(),ce=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,ke=ye||ce,!(ke&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return!1;for(me=0<=pe.split(',')[0].indexOf('base64')?atob(pe.split(',')[1]):decodeURIComponent(pe.split(',')[1]),ue=new ArrayBuffer(me.length),be=new Uint8Array(ue),(_e=ve=0,xe=me.length);0<=xe?ve<=xe:ve>=xe;_e=0<=xe?++ve:--ve)be[_e]=me.charCodeAt(_e);return(we=pe.split(',')[0].split(':')[1].split(';')[0],ye)?(he=fe?be:ue,new Blob([he],{type:we})):(ge=new ce,ge.append(ue),ge.getBlob(we))},se.prototype.throttle=function(pe,ce){let ue,ge,he,me,fe,ye,_e;return me=0,_e=0,he=ue=fe=null,ge=function(){return _e=0,me=+new Date,fe=pe.apply(he,ue),he=null,ue=null},ye=function(){let be;return he=this,ue=arguments,be=new Date-me,_e||(be>=ce?ge():_e=setTimeout(ge,ce-be)),fe},ye.clear=function(){if(_e)return clearTimeout(_e),ge()},ye},se.prototype.formatHTML=function(pe){let ce,ue,ge,he,me,fe,ye,_e,be;for(fe=/<(\/?)(.+?)(\/?)>/g,_e='',he=0,ge=null,ue='  ',ye=function(ve,we){return Array(we+1).join(ve)};null!==(me=fe.exec(pe));)me.isBlockNode=-1<t.inArray(me[2],this.blockNodes),me.isStartTag='/'!==me[1]&&'/'!==me[3],me.isEndTag='/'===me[1]||'/'===me[3],ce=ge?ge.index+ge[0].length:0,0<(be=pe.substring(ce,me.index)).length&&t.trim(be)&&(_e+=be),me.isBlockNode&&me.isEndTag&&!me.isStartTag&&(he-=1),me.isBlockNode&&me.isStartTag&&(!(ge&&ge.isBlockNode&&ge.isEndTag)&&(_e+='\n'),_e+=ye(ue,he)),_e+=me[0],me.isBlockNode&&me.isEndTag&&(_e+='\n'),me.isBlockNode&&me.isStartTag&&(he+=1),ge=me;return t.trim(_e)},se}(a),G=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.pluginName='Toolbar',se.prototype.opts={toolbar:!0,toolbarFloat:!0,toolbarHidden:!1,toolbarFloatOffset:0},se.prototype._tpl={wrapper:'<div class="simditor-toolbar"><ul></ul></div>',separator:'<li><span class="separator"></span></li>'},se.prototype._init=function(){let pe,ce,ue;if(this.editor=this._module,!!this.opts.toolbar)return t.isArray(this.opts.toolbar)||(this.opts.toolbar=['bold','italic','underline','strikethrough','|','ol','ul','blockquote','code','|','link','image','|','indent','outdent']),this._render(),this.list.on('click',function(){return!1}),this.wrapper.on('mousedown',function(ge){return function(){return ge.list.find('.menu-on').removeClass('.menu-on')}}(this)),t(document).on('mousedown.simditor'+this.editor.id,function(ge){return function(){return ge.list.find('.menu-on').removeClass('.menu-on')}}(this)),!this.opts.toolbarHidden&&this.opts.toolbarFloat&&(this.wrapper.css('top',this.opts.toolbarFloatOffset),ue=0,ce=function(ge){return function(){return ge.wrapper.css('position','static'),ge.wrapper.width('auto'),ge.editor.util.reflow(ge.wrapper),ge.wrapper.width(ge.wrapper.outerWidth()),ge.wrapper.css('left',ge.editor.util.os.mobile?ge.wrapper.position().left:ge.wrapper.offset().left),ge.wrapper.css('position',''),ue=ge.wrapper.outerHeight(),ge.editor.placeholderEl.css('top',ue),!0}}(this),pe=null,t(window).on('resize.simditor-'+this.editor.id,function(){return pe=ce()}),t(window).on('scroll.simditor-'+this.editor.id,function(ge){return function(){let me,fe,ye;if(ge.wrapper.is(':visible'))if(ye=ge.editor.wrapper.offset().top,me=ye+ge.editor.wrapper.outerHeight()-80,fe=t(document).scrollTop()+ge.opts.toolbarFloatOffset,fe<=ye||fe>=me){if(ge.editor.wrapper.removeClass('toolbar-floating').css('padding-top',''),ge.editor.util.os.mobile)return ge.wrapper.css('top',ge.opts.toolbarFloatOffset);}else if(pe||(pe=ce()),ge.editor.wrapper.addClass('toolbar-floating').css('padding-top',ue),ge.editor.util.os.mobile)return ge.wrapper.css('top',fe-ye+ge.opts.toolbarFloatOffset)}}(this))),this.editor.on('destroy',function(ge){return function(){return ge.buttons.length=0}}(this)),t(document).on('mousedown.simditor-'+this.editor.id,function(ge){return function(){return ge.list.find('li.menu-on').removeClass('menu-on')}}(this))},se.prototype._render=function(){let pe,ce,ue,ge;for(this.buttons=[],this.wrapper=t(this._tpl.wrapper).prependTo(this.editor.wrapper),this.list=this.wrapper.find('ul'),ge=this.opts.toolbar,(pe=0,ce=ge.length);pe<ce;pe++){if(ue=ge[pe],'|'===ue){t(this._tpl.separator).appendTo(this.list);continue}if(!this.constructor.buttons[ue]){throw new Error('simditor: invalid toolbar button '+ue)}this.buttons.push(new this.constructor.buttons[ue]({editor:this.editor}))}if(this.opts.toolbarHidden)return this.wrapper.hide()},se.prototype.findButton=function(pe){let ce;return ce=this.list.find('.toolbar-item-'+pe).data('button'),null==ce?null:ce},se.addButton=function(pe){return this.buttons[pe.prototype.name]=pe},se.buttons={},se}(a),O=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.pluginName='Indentation',se.prototype.opts={tabIndent:!0},se.prototype._init=function(){return this.editor=this._module,this.editor.keystroke.add('tab','*',function(pe){return function(ce){let ue;return ue=pe.editor.toolbar.findButton('code'),pe.opts.tabIndent||ue&&ue.active?pe.indent(ce.shiftKey):void 0}}(this))},se.prototype.indent=function(pe){let ce,ue,ge,he,me;return ge=this.editor.selection.startNodes(),ue=this.editor.selection.endNodes(),ce=this.editor.selection.blockNodes(),he=[],ce=ce.each(function(fe,ye){let _e,be,ve,we,xe;for(_e=!0,be=ve=0,we=he.length;ve<we;be=++ve)if(xe=he[be],t.contains(ye,xe)){_e=!1;break}else if(t.contains(xe,ye)){he.splice(be,1,ye),_e=!1;break}if(_e)return he.push(ye)}),ce=t(he),me=!1,ce.each(function(fe){return function(ye,_e){let be;if(be=pe?fe.outdentBlock(_e):fe.indentBlock(_e),be)return me=be}}(this)),me},se.prototype.indentBlock=function(pe){let ce,ue,ge,he,me,fe,ye,_e,be,ve;if(ce=t(pe),!!ce.length){if(ce.is('pre')){if(fe=this.editor.selection.containerNode(),!(fe.is(ce)||fe.closest('pre').is(ce)))return;this.indentText(this.editor.selection.range())}else if(ce.is('li')){if(me=ce.prev('li'),1>me.length)return;this.editor.selection.save(),ve=ce.parent()[0].tagName,ue=me.children('ul, ol'),0<ue.length?ue.append(ce):t('<'+ve+'/>').append(ce).appendTo(me),this.editor.selection.restore()}else if(ce.is('p, h1, h2, h3, h4'))be=parseInt(ce.css('margin-left'))||0,be=(Math.round(be/this.opts.indentWidth)+1)*this.opts.indentWidth,ce.css('margin-left',be);else if(ce.is('table')||ce.is('.simditor-table')){if(ye=this.editor.selection.containerNode().closest('td, th'),ge=ye.next('td, th'),0<ge.length||(_e=ye.parent('tr'),he=_e.next('tr'),1>he.length&&_e.parent().is('thead')&&(he=_e.parent('thead').next('tbody').find('tr:first')),ge=he.find('td:first, th:first')),!(0<ye.length&&0<ge.length))return;this.editor.selection.setRangeAtEndOf(ge)}else return!1;return!0}},se.prototype.indentText=function(pe){let ce,ue;return ce=pe.toString().replace(/^(?=.+)/mg,'\xA0\xA0'),ue=document.createTextNode(ce||'\xA0\xA0'),pe.deleteContents(),pe.insertNode(ue),ce?(pe.selectNode(ue),this.editor.selection.range(pe)):this.editor.selection.setRangeAfter(ue)},se.prototype.outdentBlock=function(pe){let ce,ue,ge,he,me,fe,ye,_e,be,ve;if(ce=t(pe),!!(ce&&0<ce.length)){if(ce.is('pre')){if(he=this.editor.selection.containerNode(),!(he.is(ce)||he.closest('pre').is(ce)))return;this.outdentText(ve)}else if(ce.is('li'))ue=ce.parent(),ge=ue.parent('li'),this.editor.selection.save(),1>ge.length?(ve=document.createRange(),ve.setStartBefore(ue[0]),ve.setEndBefore(ce[0]),ue.before(ve.extractContents()),t('<p/>').insertBefore(ue).after(ce.children('ul, ol')).append(ce.contents()),ce.remove()):(0<ce.next('li').length&&t('<'+ue[0].tagName+'/>').append(ce.nextAll('li')).appendTo(ce),ce.insertAfter(ge),1>ue.children('li').length&&ue.remove()),this.editor.selection.restore();else if(ce.is('p, h1, h2, h3, h4'))be=parseInt(ce.css('margin-left'))||0,be=Math.max(Math.round(be/this.opts.indentWidth)-1,0)*this.opts.indentWidth,ce.css('margin-left',0===be?'':be);else if(ce.is('table')||ce.is('.simditor-table')){if(ye=this.editor.selection.containerNode().closest('td, th'),me=ye.prev('td, th'),0<me.length||(_e=ye.parent('tr'),fe=_e.prev('tr'),1>fe.length&&_e.parent().is('tbody')&&(fe=_e.parent('tbody').prev('thead').find('tr:first')),me=fe.find('td:last, th:last')),!(0<ye.length&&0<me.length))return;this.editor.selection.setRangeAtEndOf(me)}else return!1;return!0}},se.prototype.outdentText=function(){},se}(a),w=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.pluginName='Clipboard',se.prototype.opts={pasteImage:!1,cleanPaste:!1},se.prototype._init=function(){return this.editor=this._module,this.opts.pasteImage&&'string'!=typeof this.opts.pasteImage&&(this.opts.pasteImage='inline'),this.editor.body.on('paste',function(pe){return function(ce){let ue;if(!(pe.pasting||pe._pasteBin))return!1!==pe.editor.triggerHandler(ce)&&(ue=pe.editor.selection.deleteRangeContents(),pe.editor.body.html()?!ue.collapsed&&ue.collapse(!0):(pe.editor.formatter.format(),pe.editor.selection.setRangeAtStartOf(pe.editor.body.find('p:first'))),!pe._processPasteByClipboardApi(ce))&&(pe.editor.inputManager.throttledValueChanged.clear(),pe.editor.inputManager.throttledSelectionChanged.clear(),pe.editor.undoManager.throttledPushState.clear(),pe.editor.selection.reset(),pe.editor.undoManager.resetCaretPosition(),pe.pasting=!0,pe._getPasteContent(function(ge){return pe._processPasteContent(ge),pe._pasteInBlockEl=null,pe._pastePlainText=null,pe.pasting=!1}))}}(this))},se.prototype._processPasteByClipboardApi=function(pe){let ce,ue,ge,he;return this.editor.util.browser.edge?void 0:pe.originalEvent.clipboardData&&pe.originalEvent.clipboardData.items&&0<pe.originalEvent.clipboardData.items.length&&(ue=pe.originalEvent.clipboardData.items[0],/^image\//.test(ue.type))?(ce=ue.getAsFile(),!(null!=ce&&this.opts.pasteImage))||(ce.name||(ce.name='Clipboard Image.png'),!1===this.editor.triggerHandler('pasting',[ce]))?void 0:(he={},he[this.opts.pasteImage]=!0,null!=(ge=this.editor.uploader)&&ge.upload(ce,he),!0):void 0},se.prototype._getPasteContent=function(pe){let ce;return this._pasteBin=t('<div contenteditable="true" />').addClass('simditor-paste-bin').attr('tabIndex','-1').appendTo(this.editor.el),ce={html:this.editor.body.html(),caret:this.editor.undoManager.caretPosition()},this._pasteBin.focus(),setTimeout(function(ue){return function(){let ge;return ue.editor.hidePopover(),ue.editor.body.get(0).innerHTML=ce.html,ue.editor.undoManager.caretPosition(ce.caret),ue.editor.body.focus(),ue.editor.selection.reset(),ue.editor.selection.range(),ue._pasteInBlockEl=ue.editor.selection.blockNodes().last(),ue._pastePlainText=ue.opts.cleanPaste||ue._pasteInBlockEl.is('pre, table'),ue._pastePlainText?ge=ue.editor.formatter.clearHtml(ue._pasteBin.html(),!0):(ge=t('<div/>').append(ue._pasteBin.contents()),ge.find('style').remove(),ge.find('table colgroup').remove(),ue.editor.formatter.format(ge),ue.editor.formatter.decorate(ge),ue.editor.formatter.beautify(ge.children()),ge=ge.contents()),ue._pasteBin.remove(),ue._pasteBin=null,pe(ge)}}(this),0)},se.prototype._processPasteContent=function(pe){let ce,ue,ge,he,me,fe,ye,_e,be,ve,we,xe,ke,Ce,Te,Ne,Se,Ae,Ee,Be,Re,Ie,Oe,Pe,Me,ze;if(!1!==this.editor.triggerHandler('pasting',[pe])&&(ce=this._pasteInBlockEl,!!pe)){if(this._pastePlainText){if(ce.is('table')){for(Se=pe.split('\n'),ve=Se.pop(),(_e=0,we=Se.length);_e<we;_e++)Ne=Se[_e],this.editor.selection.insertNode(document.createTextNode(Ne)),this.editor.selection.insertNode(t('<br/>'));this.editor.selection.insertNode(document.createTextNode(ve))}else for(pe=t('<div/>').text(pe),Ie=pe.contents(),(be=0,xe=Ie.length);be<xe;be++)Ee=Ie[be],this.editor.selection.insertNode(t(Ee)[0]);}else if(ce.is(this.editor.body))for(Ae=0,ke=pe.length;Ae<ke;Ae++)Ee=pe[Ae],this.editor.selection.insertNode(Ee);else{if(1>pe.length)return;if(1!==pe.length)ce.is('li')&&(ce=ce.parent()),this.editor.selection.rangeAtStartOf(ce)?ye='before':this.editor.selection.rangeAtEndOf(ce)?ye='after':(this.editor.selection.breakBlockEl(ce),ye='before'),ce[ye](pe),this.editor.selection.setRangeAtEndOf(pe.last());else if(pe.is('p')){if(he=pe.contents(),ce.is('h1, h2, h3, h4, h5')&&he.length&&he.css('font-size',''),1===he.length&&he.is('img')){if(ue=he,/^data:image/.test(ue.attr('src')))return this.opts.pasteImage?(ge=this.editor.util.dataURLtoBlob(ue.attr('src')),ge.name='Clipboard Image.png',Me={},Me[this.opts.pasteImage]=!0,void(null!=(Oe=this.editor.uploader)&&Oe.upload(ge,Me))):void 0;if(new RegExp('^blob:'+location.origin+'/').test(ue.attr('src')))return this.opts.pasteImage?(Me={},Me[this.opts.pasteImage]=!0,me=this.editor.util.dataURLtoBlob,ze=this.editor.uploader,fe=new Image,fe.onload=function(){let Le;Le=document.createElement('canvas'),Le.width=fe.naturalWidth,Le.height=fe.naturalHeight,Le.getContext('2d').drawImage(fe,0,0),ge=me(Le.toDataURL('image/png')),ge.name='Clipboard Image.png',null!==ze&&ze.upload(ge,Me)},void(fe.src=ue.attr('src'))):void 0;if(ue.is('img[src^="webkit-fake-url://"]'))return}for(Be=0,Ce=he.length;Be<Ce;Be++)Ee=he[Be],this.editor.selection.insertNode(Ee)}else if(ce.is('p')&&this.editor.util.isEmptyNode(ce))ce.replaceWith(pe),this.editor.selection.setRangeAtEndOf(pe);else if(!pe.is('ul, ol'))ce.after(pe),this.editor.selection.setRangeAtEndOf(pe);else if(1===pe.find('li').length)for(pe=t('<div/>').text(pe.text()),Pe=pe.contents(),(Re=0,Te=Pe.length);Re<Te;Re++)Ee=Pe[Re],this.editor.selection.insertNode(t(Ee)[0]);else ce.is('li')?(ce.parent().after(pe),this.editor.selection.setRangeAtEndOf(pe)):(ce.after(pe),this.editor.selection.setRangeAtEndOf(pe))}return this.editor.inputManager.throttledValueChanged()}},se}(a),K=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.connect(te),se.connect(P),se.connect(F),se.connect(Z),se.connect(z),se.connect(A),se.connect(G),se.connect(O),se.connect(w),se.count=0,se.prototype.opts={textarea:null,placeholder:'',defaultImage:'images/image.png',params:{},upload:!1,indentWidth:40},se.prototype._init=function(){let ce,ue;if(this.textarea=t(this.opts.textarea),this.opts.placeholder=this.opts.placeholder||this.textarea.attr('placeholder'),!this.textarea.length){throw new Error('simditor: param textarea is required.')}if(ce=this.textarea.data('simditor'),null!=ce&&ce.destroy(),this.id=++se.count,this._render(),d)this.hotkeys=d({el:this.body});else{throw new Error('simditor: simple-hotkeys is required.')}if(this.opts.upload&&s&&(ue='object'==typeof this.opts.upload?this.opts.upload:{},this.uploader=s(ue)),this.on('initialized',function(ge){return function(){if(ge.opts.placeholder&&ge.on('valuechanged',function(){return ge._placeholder()}),ge.setValue(ge.textarea.val().trim()||''),ge.textarea.attr('autofocus'))return ge.focus()}}(this)),this.util.browser.mozilla){this.util.reflow();try{return document.execCommand('enableObjectResizing',!1,!1),document.execCommand('enableInlineTableEditing',!1,!1)}catch(ge){}}},se.prototype._tpl='<div class="simditor">\n  <div class="simditor-wrapper">\n    <div class="simditor-placeholder"></div>\n    <div class="simditor-body" contenteditable="true">\n    </div>\n  </div>\n</div>',se.prototype._render=function(){let pe,ce,ue,ge;if(this.el=t(this._tpl).insertBefore(this.textarea),this.wrapper=this.el.find('.simditor-wrapper'),this.body=this.wrapper.find('.simditor-body'),this.placeholderEl=this.wrapper.find('.simditor-placeholder').append(this.opts.placeholder),this.el.data('simditor',this),this.wrapper.append(this.textarea),this.textarea.data('simditor',this).blur(),this.body.attr('tabindex',this.textarea.attr('tabindex')),this.util.os.mac?this.el.addClass('simditor-mac'):this.util.os.linux&&this.el.addClass('simditor-linux'),this.util.os.mobile&&this.el.addClass('simditor-mobile'),this.opts.params){for(pe in ce=this.opts.params,ue=[],ce)ge=ce[pe],ue.push(t('<input/>',{type:'hidden',name:pe,value:ge}).insertAfter(this.textarea));return ue}},se.prototype._placeholder=function(){let pe;return pe=this.body.children(),0===pe.length||1===pe.length&&this.util.isEmptyNode(pe)&&parseInt(pe.css('margin-left')||0)<this.opts.indentWidth?this.placeholderEl.show():this.placeholderEl.hide()},se.prototype.setValue=function(pe){return this.hidePopover(),this.textarea.val(pe),this.body.get(0).innerHTML=pe,this.formatter.format(),this.formatter.decorate(),this.util.reflow(this.body),this.inputManager.lastCaretPosition=null,this.trigger('valuechanged')},se.prototype.getValue=function(){return this.sync()},se.prototype.sync=function(){let pe,ce,ue,ge,he,me;for(ce=this.body.clone(),this.formatter.undecorate(ce),this.formatter.format(ce),this.formatter.autolink(ce),pe=ce.children(),he=pe.last('p'),ge=pe.first('p');he.is('p')&&this.util.isEmptyNode(he);)ue=he,he=he.prev('p'),ue.remove();for(;ge.is('p')&&this.util.isEmptyNode(ge);)ue=ge,ge=he.next('p'),ue.remove();return ce.find('img.uploading').remove(),me=t.trim(ce.html()),this.textarea.val(me),me},se.prototype.focus=function(){let pe,ce;return this.body.is(':visible')&&this.body.is('[contenteditable]')?this.inputManager.lastCaretPosition?(this.undoManager.caretPosition(this.inputManager.lastCaretPosition),this.inputManager.lastCaretPosition=null):(pe=this.body.children().last(),pe.is('p')||(pe=t('<p/>').append(this.util.phBr).appendTo(this.body)),ce=document.createRange(),this.selection.setRangeAtEndOf(pe,ce)):void this.el.find('textarea:visible').focus()},se.prototype.blur=function(){return this.body.is(':visible')&&this.body.is('[contenteditable]')?this.body.blur():this.body.find('textarea:visible').blur()},se.prototype.hidePopover=function(){return this.el.find('.simditor-popover').each(function(pe,ce){if(ce=t(ce).data('popover'),ce.active)return ce.hide()})},se.prototype.destroy=function(){return this.triggerHandler('destroy'),this.textarea.closest('form').off('.simditor .simditor-'+this.id),this.selection.clear(),this.inputManager.focused=!1,this.textarea.insertBefore(this.el).hide().val('').removeData('simditor'),this.el.remove(),t(document).off('.simditor-'+this.id),t(window).off('.simditor-'+this.id),this.off()},se}(a),K.i18n={'zh-CN':{blockquote:'\u5F15\u7528',bold:'\u52A0\u7C97\u6587\u5B57',code:'\u63D2\u5165\u4EE3\u7801',color:'\u6587\u5B57\u989C\u8272',coloredText:'\u5F69\u8272\u6587\u5B57',hr:'\u5206\u9694\u7EBF',image:'\u63D2\u5165\u56FE\u7247',externalImage:'\u5916\u94FE\u56FE\u7247',uploadImage:'\u4E0A\u4F20\u56FE\u7247',uploadFailed:'\u4E0A\u4F20\u5931\u8D25\u4E86',uploadError:'\u4E0A\u4F20\u51FA\u9519\u4E86',imageUrl:'\u56FE\u7247\u5730\u5740',imageSize:'\u56FE\u7247\u5C3A\u5BF8',imageAlt:'\u56FE\u7247\u63CF\u8FF0',restoreImageSize:'\u8FD8\u539F\u56FE\u7247\u5C3A\u5BF8',uploading:'\u6B63\u5728\u4E0A\u4F20',indent:'\u5411\u53F3\u7F29\u8FDB',outdent:'\u5411\u5DE6\u7F29\u8FDB',italic:'\u659C\u4F53\u6587\u5B57',link:'\u63D2\u5165\u94FE\u63A5',linkText:'\u94FE\u63A5\u6587\u5B57',linkUrl:'\u94FE\u63A5\u5730\u5740',linkTarget:'\u6253\u5F00\u65B9\u5F0F',openLinkInCurrentWindow:'\u5728\u5F53\u524D\u7A97\u53E3\u4E2D\u6253\u5F00',openLinkInNewWindow:'\u5728\u65B0\u7A97\u53E3\u4E2D\u6253\u5F00',removeLink:'\u79FB\u9664\u94FE\u63A5',ol:'\u6709\u5E8F\u5217\u8868',ul:'\u65E0\u5E8F\u5217\u8868',strikethrough:'\u5220\u9664\u7EBF\u6587\u5B57',table:'\u8868\u683C',deleteRow:'\u5220\u9664\u884C',insertRowAbove:'\u5728\u4E0A\u9762\u63D2\u5165\u884C',insertRowBelow:'\u5728\u4E0B\u9762\u63D2\u5165\u884C',deleteColumn:'\u5220\u9664\u5217',insertColumnLeft:'\u5728\u5DE6\u8FB9\u63D2\u5165\u5217',insertColumnRight:'\u5728\u53F3\u8FB9\u63D2\u5165\u5217',deleteTable:'\u5220\u9664\u8868\u683C',title:'\u6807\u9898',normalText:'\u666E\u901A\u6587\u672C',underline:'\u4E0B\u5212\u7EBF\u6587\u5B57',alignment:'\u6C34\u5E73\u5BF9\u9F50',alignCenter:'\u5C45\u4E2D',alignLeft:'\u5C45\u5DE6',alignRight:'\u5C45\u53F3',selectLanguage:'\u9009\u62E9\u7A0B\u5E8F\u8BED\u8A00',fontScale:'\u5B57\u4F53\u5927\u5C0F',fontScaleXLarge:'\u8D85\u5927\u5B57\u4F53',fontScaleLarge:'\u5927\u53F7\u5B57\u4F53',fontScaleNormal:'\u6B63\u5E38\u5927\u5C0F',fontScaleSmall:'\u5C0F\u53F7\u5B57\u4F53',fontScaleXSmall:'\u8D85\u5C0F\u5B57\u4F53',fullscreen:'\u5168\u5C4F/\u8FD8\u539F',markdown:'markdown\u7F16\u5199\u98CE\u683C',html:'\u67E5\u770Bhtml\u683C\u5F0F\u6E90\u7801'},'en-US':{blockquote:'Block Quote',bold:'Bold',code:'Code',color:'Text Color',coloredText:'Colored Text',hr:'Horizontal Line',image:'Insert Image',externalImage:'External Image',uploadImage:'Upload Image',uploadFailed:'Upload failed',uploadError:'Error occurs during upload',imageUrl:'Url',imageSize:'Size',imageAlt:'Alt',restoreImageSize:'Restore Origin Size',uploading:'Uploading',indent:'Indent',outdent:'Outdent',italic:'Italic',link:'Insert Link',linkText:'Text',linkUrl:'Url',linkTarget:'Target',openLinkInCurrentWindow:'Open link in current window',openLinkInNewWindow:'Open link in new window',removeLink:'Remove Link',ol:'Ordered List',ul:'Unordered List',strikethrough:'Strikethrough',table:'Table',deleteRow:'Delete Row',insertRowAbove:'Insert Row Above',insertRowBelow:'Insert Row Below',deleteColumn:'Delete Column',insertColumnLeft:'Insert Column Left',insertColumnRight:'Insert Column Right',deleteTable:'Delete Table',title:'Title',normalText:'Text',underline:'Underline',alignment:'Alignment',alignCenter:'Align Center',alignLeft:'Align Left',alignRight:'Align Right',selectLanguage:'Select Language',fontScale:'Font Size',fontScaleXLarge:'X Large Size',fontScaleLarge:'Large Size',fontScaleNormal:'Normal Size',fontScaleSmall:'Small Size',fontScaleXSmall:'X Small Size'}},v=function(de){function se(pe){this.editor=pe.editor,this.title=this._t(this.name),se.__super__.constructor.call(this,pe)}return oe(se,de),se.prototype._tpl={item:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span></span></a></li>',menuWrapper:'<div class="toolbar-menu"></div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span></span></a></li>',separator:'<li><span class="separator"></span></li>'},se.prototype.name='',se.prototype.icon='',se.prototype.title='',se.prototype.text='',se.prototype.htmlTag='',se.prototype.disableTag='',se.prototype.menu=!1,se.prototype.active=!1,se.prototype.disabled=!1,se.prototype.needFocus=!0,se.prototype.shortcut=null,se.prototype._init=function(){let pe,ce,ue,ge;for(this.render(),this.el.on('mousedown',function(he){return function(me){let fe,ye,_e;return(me.preventDefault(),ye=he.needFocus&&!he.editor.inputManager.focused,!he.el.hasClass('disabled'))&&((ye&&he.editor.focus(),he.menu)?(he.wrapper.toggleClass('menu-on').siblings('li').removeClass('menu-on'),he.wrapper.is('.menu-on')&&(fe=he.menuWrapper.offset().left+he.menuWrapper.outerWidth()+5-he.editor.wrapper.offset().left-he.editor.wrapper.outerWidth(),0<fe&&he.menuWrapper.css({left:'auto',right:0}),he.trigger('menuexpand')),!1):(_e=he.el.data('param'),he.command(_e),!1))}}(this)),this.wrapper.on('click','a.menu-item',function(he){return function(me){let fe,ye,_e;return(me.preventDefault(),fe=t(me.currentTarget),he.wrapper.removeClass('menu-on'),ye=he.needFocus&&!he.editor.inputManager.focused,!(fe.hasClass('disabled')||ye))&&(he.editor.toolbar.wrapper.removeClass('menu-on'),_e=fe.data('param'),he.command(_e),!1)}}(this)),this.wrapper.on('mousedown','a.menu-item',function(){return!1}),this.editor.on('blur',function(he){return function(){let me;if(me=he.editor.body.is(':visible')&&he.editor.body.is('[contenteditable]'),me&&!he.editor.clipboard.pasting)return he.setActive(!1),he.setDisabled(!1)}}(this)),null!=this.shortcut&&this.editor.hotkeys.add(this.shortcut,function(he){return function(){return he.el.mousedown(),!1}}(this)),ue=this.htmlTag.split(','),(pe=0,ce=ue.length);pe<ce;pe++)ge=ue[pe],ge=t.trim(ge),ge&&0>t.inArray(ge,this.editor.formatter._allowedTags)&&this.editor.formatter._allowedTags.push(ge);return this.editor.on('selectionchanged',function(he){return function(){if(he.editor.inputManager.focused)return he._status()}}(this))},se.prototype.iconClassOf=function(pe){return pe?'simditor-icon simditor-icon-'+pe:''},se.prototype.setIcon=function(pe){return this.el.find('span').removeClass().addClass(this.iconClassOf(pe)).text(this.text)},se.prototype.render=function(){if(this.wrapper=t(this._tpl.item).appendTo(this.editor.toolbar.list),this.el=this.wrapper.find('a.toolbar-item'),this.el.attr('title',this.title).addClass('toolbar-item-'+this.name).data('button',this),this.setIcon(this.icon),!!this.menu)return this.menuWrapper=t(this._tpl.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass('toolbar-menu-'+this.name),this.renderMenu()},se.prototype.renderMenu=function(){let pe,ce,ue,ge,he,me,fe,ye;if(t.isArray(this.menu)){for(this.menuEl=t('<ul/>').appendTo(this.menuWrapper),me=this.menu,ye=[],(ue=0,ge=me.length);ue<ge;ue++){if(he=me[ue],'|'===he){t(this._tpl.separator).appendTo(this.menuEl);continue}ce=t(this._tpl.menuItem).appendTo(this.menuEl),pe=ce.find('a.menu-item').attr({title:null==(fe=he.title)?he.text:fe,'data-param':he.param}).addClass('menu-item-'+he.name),he.icon?ye.push(pe.find('span').addClass(this.iconClassOf(he.icon))):ye.push(pe.find('span').text(he.text))}return ye}},se.prototype.setActive=function(pe){if(pe!==this.active)return this.active=pe,this.el.toggleClass('active',this.active)},se.prototype.setDisabled=function(pe){if(pe!==this.disabled)return this.disabled=pe,this.el.toggleClass('disabled',this.disabled)},se.prototype._disableStatus=function(){let pe,ce,ue;return ue=this.editor.selection.startNodes(),ce=this.editor.selection.endNodes(),pe=0<ue.filter(this.disableTag).length||0<ce.filter(this.disableTag).length,this.setDisabled(pe),this.disabled&&this.setActive(!1),this.disabled},se.prototype._activeStatus=function(){let pe,ce,ue,ge,he;return he=this.editor.selection.startNodes(),ue=this.editor.selection.endNodes(),ge=he.filter(this.htmlTag),ce=ue.filter(this.htmlTag),pe=0<ge.length&&0<ce.length&&ge.is(ce),this.node=pe?ge:null,this.setActive(pe),this.active},se.prototype._status=function(){return this._disableStatus(),this.disabled?void 0:this._activeStatus()},se.prototype.command=function(){},se.prototype._t=function(){let pe,ce,ue;return pe=1<=arguments.length?le.call(arguments,0):[],ue=se.__super__._t.apply(this,pe),ue||(ue=(ce=this.editor)._t.apply(ce,pe)),ue},se}(a),K.Button=v,V=function(de){function se(pe){this.button=pe.button,this.editor=pe.button.editor,se.__super__.constructor.call(this,pe)}return oe(se,de),se.prototype.offset={top:4,left:0},se.prototype.target=null,se.prototype.active=!1,se.prototype._init=function(){return this.el=t('<div class="simditor-popover"></div>').appendTo(this.editor.el).data('popover',this),this.render(),this.el.on('mouseenter',function(pe){return function(){return pe.el.addClass('hover')}}(this)),this.el.on('mouseleave',function(pe){return function(){return pe.el.removeClass('hover')}}(this))},se.prototype.render=function(){},se.prototype._initLabelWidth=function(){let pe;if(pe=this.el.find('.settings-field'),!!(0<pe.length))return this._labelWidth=0,pe.each(function(ce){return function(ue,ge){let he,me;return he=t(ge),me=he.find('label'),0<me.length?ce._labelWidth=Math.max(ce._labelWidth,me.width()):void 0}}(this)),pe.find('label').width(this._labelWidth)},se.prototype.show=function(pe,ce){if(null==ce&&(ce='bottom'),null!=pe)return this.el.siblings('.simditor-popover').each(function(ue,ge){if(ge=t(ge).data('popover'),ge.active)return ge.hide()}),this.active&&this.target&&this.target.removeClass('selected'),this.target=pe.addClass('selected'),this.active?(this.refresh(ce),this.trigger('popovershow')):(this.active=!0,this.el.css({left:-9999}).show(),this._labelWidth||this._initLabelWidth(),this.editor.util.reflow(),this.refresh(ce),this.trigger('popovershow'))},se.prototype.hide=function(){if(this.active)return this.target&&this.target.removeClass('selected'),this.target=null,this.active=!1,this.el.hide(),this.trigger('popoverhide')},se.prototype.refresh=function(pe){let ce,ue,ge,he,me,fe;if(null==pe&&(pe='bottom'),!!this.active)return ce=this.editor.el.offset(),me=this.target.offset(),he=this.target.outerHeight(),'bottom'===pe?fe=me.top-ce.top+he:'top'==pe&&(fe=me.top-ce.top-this.el.height()),ge=this.editor.wrapper.width()-this.el.outerWidth()-10,ue=Math.min(me.left-ce.left,ge),this.el.css({top:fe+this.offset.top,left:ue+this.offset.left})},se.prototype.destroy=function(){return this.target=null,this.active=!1,this.editor.off('.linkpopover'),this.el.remove()},se.prototype._t=function(){let pe,ce,ue;return pe=1<=arguments.length?le.call(arguments,0):[],ue=se.__super__._t.apply(this,pe),ue||(ue=(ce=this.button)._t.apply(ce,pe)),ue},se}(a),K.Popover=V,Q=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='title',se.prototype.htmlTag='h1, h2, h3, h4, h5',se.prototype.disableTag='pre, table',se.prototype._init=function(){return this.menu=[{name:'normal',text:this._t('normalText'),param:'p'},'|',{name:'h1',text:this._t('title')+' 1',param:'h1'},{name:'h2',text:this._t('title')+' 2',param:'h2'},{name:'h3',text:this._t('title')+' 3',param:'h3'},{name:'h4',text:this._t('title')+' 4',param:'h4'},{name:'h5',text:this._t('title')+' 5',param:'h5'}],se.__super__._init.call(this)},se.prototype.setActive=function(pe,ce){if(se.__super__.setActive.call(this,pe),pe&&(ce||(ce=this.node[0].tagName.toLowerCase())),this.el.removeClass('active-p active-h1 active-h2 active-h3 active-h4 active-h5'),pe)return this.el.addClass('active active-'+ce)},se.prototype.command=function(pe){let ce;return ce=this.editor.selection.rootNodes(),this.editor.selection.save(),ce.each(function(ue){return function(ge,he){let me;return me=t(he),me.is('blockquote')||me.is(pe)||me.is(ue.disableTag)||ue.editor.util.isDecoratedNode(me)?void 0:t('<'+pe+'/>').append(me.contents()).replaceAll(me)}}(this)),this.editor.selection.restore(),this.editor.trigger('valuechanged')},se}(v),K.Toolbar.addButton(Q),S=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='fontScale',se.prototype.icon='font',se.prototype.htmlTag='span',se.prototype.disableTag='pre, h1, h2, h3, h4, h5',se.prototype.sizeMap={'x-large':'1.5em',large:'1.25em',small:'.75em','x-small':'.5em'},se.prototype._init=function(){return this.menu=[{name:'150%',text:this._t('fontScaleXLarge'),param:'5'},{name:'125%',text:this._t('fontScaleLarge'),param:'4'},{name:'100%',text:this._t('fontScaleNormal'),param:'3'},{name:'75%',text:this._t('fontScaleSmall'),param:'2'},{name:'50%',text:this._t('fontScaleXSmall'),param:'1'}],se.__super__._init.call(this)},se.prototype._activeStatus=function(){let pe,ce,ue,ge,he,me;return ge=this.editor.selection.range(),me=this.editor.selection.startNodes(),ue=this.editor.selection.endNodes(),he=me.filter('span[style*="font-size"]'),ce=ue.filter('span[style*="font-size"]'),pe=0<me.length&&0<ue.length&&he.is(ce),this.setActive(pe),this.active},se.prototype.command=function(pe){let ce,ue,ge;if(ge=this.editor.selection.range(),!ge.collapsed)return this.editor.selection.range(ge),document.execCommand('styleWithCSS',!1,!0),document.execCommand('fontSize',!1,pe),document.execCommand('styleWithCSS',!1,!1),this.editor.selection.reset(),this.editor.selection.range(),ue=this.editor.selection.containerNode(),ce=ue[0].nodeType===Node.TEXT_NODE?ue.closest('span[style*="font-size"]'):ue.find('span[style*="font-size"]'),ce.each(function(he){return function(me,fe){let ye,_e;return(ye=t(fe),_e=fe.style.fontSize,/large|x-large|small|x-small/.test(_e))?ye.css('fontSize',he.sizeMap[_e]):'medium'===_e?1<ye[0].style.length?ye.css('fontSize',''):ye.replaceWith(ye.contents()):void 0}}(this)),this.editor.trigger('valuechanged')},se}(v),K.Toolbar.addButton(S),_=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='bold',se.prototype.icon='bold',se.prototype.htmlTag='b, strong',se.prototype.disableTag='pre',se.prototype.shortcut='cmd+b',se.prototype._init=function(){return this.editor.util.os.mac?this.title+=' ( Cmd + b )':(this.title+=' ( Ctrl + b )',this.shortcut='ctrl+b'),se.__super__._init.call(this)},se.prototype._activeStatus=function(){let pe;return pe=!0===document.queryCommandState('bold'),this.setActive(pe),this.active},se.prototype.command=function(){return document.execCommand('bold'),this.editor.util.support.oninput||this.editor.trigger('valuechanged'),t(document).trigger('selectionchange')},se}(v),K.Toolbar.addButton(_),M=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='italic',se.prototype.icon='italic',se.prototype.htmlTag='i',se.prototype.disableTag='pre',se.prototype.shortcut='cmd+i',se.prototype._init=function(){return this.editor.util.os.mac?this.title+=' ( Cmd + i )':(this.title+=' ( Ctrl + i )',this.shortcut='ctrl+i'),se.__super__._init.call(this)},se.prototype._activeStatus=function(){let pe;return pe=!0===document.queryCommandState('italic'),this.setActive(pe),this.active},se.prototype.command=function(){return document.execCommand('italic'),this.editor.util.support.oninput||this.editor.trigger('valuechanged'),t(document).trigger('selectionchange')},se}(v),K.Toolbar.addButton(M),Y=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='underline',se.prototype.icon='underline',se.prototype.htmlTag='u',se.prototype.disableTag='pre',se.prototype.shortcut='cmd+u',se.prototype.render=function(){return this.editor.util.os.mac?this.title+=' ( Cmd + u )':(this.title+=' ( Ctrl + u )',this.shortcut='ctrl+u'),se.__super__.render.call(this)},se.prototype._activeStatus=function(){let pe;return pe=!0===document.queryCommandState('underline'),this.setActive(pe),this.active},se.prototype.command=function(){return document.execCommand('underline'),this.editor.util.support.oninput||this.editor.trigger('valuechanged'),t(document).trigger('selectionchange')},se}(v),K.Toolbar.addButton(Y),N=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='color',se.prototype.icon='tint',se.prototype.disableTag='pre',se.prototype.menu=!0,se.prototype.render=function(){let pe;return pe=1<=arguments.length?le.call(arguments,0):[],se.__super__.render.apply(this,pe)},se.prototype.renderMenu=function(){return t('<ul class="color-list">\n  <li><a href="javascript:;" class="font-color font-color-1"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-2"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-3"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-4"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-5"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-6"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-7"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-default"></a></li>\n</ul>').appendTo(this.menuWrapper),this.menuWrapper.on('mousedown','.color-list',function(){return!1}),this.menuWrapper.on('click','.font-color',function(pe){return function(ce){let ue,ge,he,me,fe,ye;if(pe.wrapper.removeClass('menu-on'),ue=t(ce.currentTarget),ue.hasClass('font-color-default')){if(ge=pe.editor.body.find('p, li'),!(0<ge.length))return;fe=window.getComputedStyle(ge[0],null).getPropertyValue('color'),he=pe._convertRgbToHex(fe)}else fe=window.getComputedStyle(ue[0],null).getPropertyValue('background-color'),he=pe._convertRgbToHex(fe);return he&&(me=pe.editor.selection.range(),!ue.hasClass('font-color-default')&&me.collapsed&&(ye=document.createTextNode(pe._t('coloredText')),me.insertNode(ye),me.selectNodeContents(ye)),pe.editor.selection.range(me),document.execCommand('styleWithCSS',!1,!0),document.execCommand('foreColor',!1,he),document.execCommand('styleWithCSS',!1,!1),!pe.editor.util.support.oninput)?pe.editor.trigger('valuechanged'):void 0}}(this))},se.prototype._convertRgbToHex=function(pe){let ce,ue,ge;return(ue=/rgb\((\d+),\s?(\d+),\s?(\d+)\)/g,ce=ue.exec(pe),!ce)?'':(ge=function(he,me,fe){let ye;return ye=function(_e){let be;return be=_e.toString(16),1===be.length?'0'+be:be},'#'+ye(he)+ye(me)+ye(fe)},ge(1*ce[1],1*ce[2],1*ce[3]))},se}(v),K.Toolbar.addButton(N),D=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.type='',se.prototype.disableTag='pre, table',se.prototype.command=function(){let ce,ue,ge;return ue=this.editor.selection.blockNodes(),ge='ul'===this.type?'ol':'ul',this.editor.selection.save(),ce=null,ue.each(function(he){return function(me,fe){let ye;return ye=t(fe),ye.is('blockquote, li')||ye.is(he.disableTag)||he.editor.util.isDecoratedNode(ye)||!t.contains(document,fe)?void 0:ye.is(he.type)?(ye.children('li').each(function(_e,be){let ve,we;return we=t(be),ve=we.children('ul, ol').insertAfter(ye),t('<p/>').append(t(be).html()||he.editor.util.phBr).insertBefore(ye)}),ye.remove()):ye.is(ge)?t('<'+he.type+'/>').append(ye.contents()).replaceAll(ye):ce&&ye.prev().is(ce)?(t('<li/>').append(ye.html()||he.editor.util.phBr).appendTo(ce),ye.remove()):(ce=t('<'+he.type+'><li></li></'+he.type+'>'),ce.find('li').append(ye.html()||he.editor.util.phBr),ce.replaceAll(ye))}}(this)),this.editor.selection.restore(),this.editor.trigger('valuechanged')},se}(v),H=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.type='ol',se.prototype.name='ol',se.prototype.icon='list-ol',se.prototype.htmlTag='ol',se.prototype.shortcut='cmd+/',se.prototype._init=function(){return this.editor.util.os.mac?this.title+=' ( Cmd + / )':(this.title+=' ( ctrl + / )',this.shortcut='ctrl+/'),se.__super__._init.call(this)},se}(D),ee=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.type='ul',se.prototype.name='ul',se.prototype.icon='list-ul',se.prototype.htmlTag='ul',se.prototype.shortcut='cmd+.',se.prototype._init=function(){return this.editor.util.os.mac?this.title+=' ( Cmd + . )':(this.title+=' ( Ctrl + . )',this.shortcut='ctrl+.'),se.__super__._init.call(this)},se}(D),K.Toolbar.addButton(H),K.Toolbar.addButton(ee),y=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='blockquote',se.prototype.icon='quote-left',se.prototype.htmlTag='blockquote',se.prototype.disableTag='pre, table',se.prototype.command=function(){let pe,ce,ue;return pe=this.editor.selection.rootNodes(),pe=pe.filter(function(ge,he){return!t(he).parent().is('blockquote')}),this.editor.selection.save(),ue=[],ce=function(ge){return function(){if(0<ue.length)return t('<'+ge.htmlTag+'/>').insertBefore(ue[0]).append(ue),ue.length=0}}(this),pe.each(function(ge){return function(he,me){let fe;return fe=t(me),fe.parent().is(ge.editor.body)?fe.is(ge.htmlTag)?(ce(),fe.children().unwrap()):fe.is(ge.disableTag)||ge.editor.util.isDecoratedNode(fe)?ce():ue.push(me):void 0}}(this)),ce(),this.editor.selection.restore(),this.editor.trigger('valuechanged')},se}(v),K.Toolbar.addButton(y),C=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='code',se.prototype.icon='code',se.prototype.htmlTag='pre',se.prototype.disableTag='ul, ol, table',se.prototype._init=function(){return se.__super__._init.call(this),this.editor.on('decorate',function(pe){return function(ce,ue){return ue.find('pre').each(function(ge,he){return pe.decorate(t(he))})}}(this)),this.editor.on('undecorate',function(pe){return function(ce,ue){return ue.find('pre').each(function(ge,he){return pe.undecorate(t(he))})}}(this))},se.prototype.render=function(){let pe;return pe=1<=arguments.length?le.call(arguments,0):[],se.__super__.render.apply(this,pe),this.popover=new T({button:this})},se.prototype._checkMode=function(){let pe,ce;return ce=this.editor.selection.range(),0<(pe=t(ce.cloneContents()).find(this.editor.util.blockNodes.join(',')))||ce.collapsed&&0===this.editor.selection.startNodes().filter('code').length?(this.inlineMode=!1,this.htmlTag='pre'):(this.inlineMode=!0,this.htmlTag='code')},se.prototype._status=function(){return this._checkMode(),se.__super__._status.call(this),this.inlineMode?void 0:this.active?this.popover.show(this.node):this.popover.hide()},se.prototype.decorate=function(pe){let ce,ue,ge,he;if(ce=pe.find('> code'),0<ce.length&&(ue=null==(ge=ce.attr('class'))||null==(he=ge.match(/lang-(\S+)/))?void 0:he[1],ce.contents().unwrap(),ue))return pe.attr('data-lang',ue)},se.prototype.undecorate=function(pe){let ce,ue;return ue=pe.attr('data-lang'),ce=t('<code/>'),ue&&-1!==ue&&ce.addClass('lang-'+ue),pe.wrapInner(ce).removeAttr('data-lang')},se.prototype.command=function(){return this.inlineMode?this._inlineCommand():this._blockCommand()},se.prototype._blockCommand=function(){let pe,ce,ue,ge;return pe=this.editor.selection.rootNodes(),ue=[],ge=[],ce=function(he){return function(){let me;if(0<ue.length)return me=t('<'+he.htmlTag+'/>').insertBefore(ue[0]).text(he.editor.formatter.clearHtml(ue)),ge.push(me[0]),ue.length=0}}(this),pe.each(function(he){return function(me,fe){let ye,_e;return ye=t(fe),ye.is(he.htmlTag)?(ce(),_e=t('<p/>').append(ye.html().replace('\n','<br/>')).replaceAll(ye),ge.push(_e[0])):ye.is(he.disableTag)||he.editor.util.isDecoratedNode(ye)||ye.is('blockquote')?ce():ue.push(fe)}}(this)),ce(),this.editor.selection.setRangeAtEndOf(t(ge).last()),this.editor.trigger('valuechanged')},se.prototype._inlineCommand=function(){let pe,ce,ue;return ue=this.editor.selection.range(),this.active?(ue.selectNodeContents(this.node[0]),this.editor.selection.save(ue),this.node.contents().unwrap(),this.editor.selection.restore()):(ce=t(ue.extractContents()),pe=t('<'+this.htmlTag+'/>').append(ce.contents()),ue.insertNode(pe[0]),ue.selectNodeContents(pe[0]),this.editor.selection.range(ue)),this.editor.trigger('valuechanged')},se}(v),T=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.render=function(){let pe,ce,ue,ge,he;for(this._tpl='<div class="code-settings">\n  <div class="settings-field">\n    <select class="select-lang">\n      <option value="-1">'+this._t('selectLanguage')+'</option>\n    </select>\n  </div>\n</div>',this.langs=this.editor.opts.codeLanguages||[{name:'Bash',value:'bash'},{name:'C++',value:'c++'},{name:'C#',value:'cs'},{name:'CSS',value:'css'},{name:'Erlang',value:'erlang'},{name:'Less',value:'less'},{name:'Sass',value:'sass'},{name:'Diff',value:'diff'},{name:'CoffeeScript',value:'coffeescript'},{name:'HTML,XML',value:'html'},{name:'JSON',value:'json'},{name:'Java',value:'java'},{name:'JavaScript',value:'js'},{name:'Markdown',value:'markdown'},{name:'Objective C',value:'oc'},{name:'PHP',value:'php'},{name:'Perl',value:'parl'},{name:'Python',value:'python'},{name:'Ruby',value:'ruby'},{name:'SQL',value:'sql'}],this.el.addClass('code-popover').append(this._tpl),this.selectEl=this.el.find('.select-lang'),he=this.langs,(ce=0,ge=he.length);ce<ge;ce++)ue=he[ce],pe=t('<option/>',{text:ue.name,value:ue.value}).appendTo(this.selectEl);return this.selectEl.on('change',function(me){return function(){let ye;return me.lang=me.selectEl.val(),ye=me.target.hasClass('selected'),me.target.removeClass().removeAttr('data-lang'),-1!==me.lang&&me.target.attr('data-lang',me.lang),ye&&me.target.addClass('selected'),me.editor.trigger('valuechanged')}}(this)),this.editor.on('valuechanged',function(me){return function(){if(me.active)return me.refresh()}}(this))},se.prototype.show=function(){let pe;return pe=1<=arguments.length?le.call(arguments,0):[],se.__super__.show.apply(this,pe),this.lang=this.target.attr('data-lang'),null==this.lang?this.selectEl.val(-1):this.selectEl.val(this.lang)},se}(V),K.Toolbar.addButton(C),L=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='link',se.prototype.icon='link',se.prototype.htmlTag='a',se.prototype.disableTag='pre',se.prototype.render=function(){let pe;return pe=1<=arguments.length?le.call(arguments,0):[],se.__super__.render.apply(this,pe),this.popover=new W({button:this})},se.prototype._status=function(){return se.__super__._status.call(this),this.active&&!this.editor.selection.rangeAtEndOf(this.node)?this.popover.show(this.node):this.popover.hide()},se.prototype.command=function(){let pe,ce,ue,ge,he,me;return he=this.editor.selection.range(),this.active?(me=document.createTextNode(this.node.text()),this.node.replaceWith(me),he.selectNode(me)):(pe=t(he.extractContents()),ge=this.editor.formatter.clearHtml(pe.contents(),!1),ce=t('<a/>',{href:'',target:'_blank',text:ge||this._t('linkText')}),0<this.editor.selection.blockNodes().length?he.insertNode(ce[0]):(ue=t('<p/>').append(ce),he.insertNode(ue[0])),he.selectNodeContents(ce[0]),this.popover.one('popovershow',function(fe){return function(){return ge?(fe.popover.urlEl.focus(),fe.popover.urlEl[0].select()):(fe.popover.textEl.focus(),fe.popover.textEl[0].select())}}(this))),this.editor.selection.range(he),this.editor.trigger('valuechanged')},se}(v),W=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.render=function(){let pe;return pe='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t('linkText')+'</label>\n    <input class="link-text" type="text"/>\n    <a class="btn-unlink" href="javascript:;" title="'+this._t('removeLink')+'"\n      tabindex="-1">\n      <span class="simditor-icon simditor-icon-unlink"></span>\n    </a>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t('linkUrl')+'</label>\n    <input class="link-url" type="text"/>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t('linkTarget')+'</label>\n    <select class="link-target">\n      <option value="_blank">'+this._t('openLinkInNewWindow')+' (_blank)</option>\n      <option value="_self">'+this._t('openLinkInCurrentWindow')+' (_self)</option>\n    </select>\n  </div>\n</div>',this.el.addClass('link-popover').append(pe),this.textEl=this.el.find('.link-text'),this.urlEl=this.el.find('.link-url'),this.unlinkEl=this.el.find('.btn-unlink'),this.selectTarget=this.el.find('.link-target'),this.textEl.on('keyup',function(ce){return function(ue){if(13!==ue.which)return ce.target.text(ce.textEl.val()),ce.editor.inputManager.throttledValueChanged()}}(this)),this.urlEl.on('keyup',function(ce){return function(ue){let ge;if(13!==ue.which)return ge=ce.urlEl.val(),/https?:\/\/|^\//ig.test(ge)||!ge||(ge='http://'+ge),ce.target.attr('href',ge),ce.editor.inputManager.throttledValueChanged()}}(this)),t([this.urlEl[0],this.textEl[0]]).on('keydown',function(ce){return function(ue){let ge;if(13===ue.which||27===ue.which||!ue.shiftKey&&9===ue.which&&t(ue.target).hasClass('link-url'))return ue.preventDefault(),ge=document.createRange(),ce.editor.selection.setRangeAfter(ce.target,ge),ce.hide(),ce.editor.inputManager.throttledValueChanged()}}(this)),this.unlinkEl.on('click',function(ce){return function(){let ge,he;return he=document.createTextNode(ce.target.text()),ce.target.replaceWith(he),ce.hide(),ge=document.createRange(),ce.editor.selection.setRangeAfter(he,ge),ce.editor.inputManager.throttledValueChanged()}}(this)),this.selectTarget.on('change',function(ce){return function(){return ce.target.attr('target',ce.selectTarget.val()),ce.editor.inputManager.throttledValueChanged()}}(this))},se.prototype.show=function(){let pe;return pe=1<=arguments.length?le.call(arguments,0):[],se.__super__.show.apply(this,pe),this.textEl.val(this.target.text()),this.urlEl.val(this.target.attr('href'))},se}(V),K.Toolbar.addButton(L),B=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='image',se.prototype.icon='picture-o',se.prototype.htmlTag='img',se.prototype.disableTag='pre, table',se.prototype.defaultImage='',se.prototype.needFocus=!1,se.prototype._init=function(){let pe,ce,ue,ge;if(!this.editor.opts.imageButton)this.menu=null!=this.editor.uploader&&[{name:'upload-image',text:this._t('uploadImage')},{name:'external-image',text:this._t('externalImage')}];else if(Array.isArray(this.editor.opts.imageButton))for(this.menu=[],ge=this.editor.opts.imageButton,(ce=0,ue=ge.length);ce<ue;ce++)pe=ge[ce],this.menu.push({name:pe+'-image',text:this._t(pe+'Image')});else this.menu=!1;return this.defaultImage=this.editor.opts.defaultImage,this.editor.body.on('click','img:not([data-non-image])',function(he){return function(me){let fe,ye;return fe=t(me.currentTarget),ye=document.createRange(),ye.selectNode(fe[0]),he.editor.selection.range(ye),he.editor.util.support.onselectionchange||he.editor.trigger('selectionchanged'),!1}}(this)),this.editor.body.on('mouseup','img:not([data-non-image])',function(){return!1}),this.editor.on('selectionchanged.image',function(he){return function(){let me,fe,ye;if(ye=he.editor.selection.range(),null!=ye)return me=t(ye.cloneContents()).contents(),1===me.length&&me.is('img:not([data-non-image])')?(fe=t(ye.startContainer).contents().eq(ye.startOffset),he.popover.show(fe)):he.popover.hide()}}(this)),this.editor.on('valuechanged.image',function(he){return function(){let me;return me=he.editor.wrapper.find('.simditor-image-loading'),0<me.length?me.each(function(fe,ye){let _e,be,ve;if(be=t(ye),_e=be.data('img'),!(_e&&0<_e.parent().length)&&(be.remove(),_e&&(ve=_e.data('file'),ve&&(he.editor.uploader.cancel(ve),1>he.editor.body.find('img.uploading').length))))return he.editor.uploader.trigger('uploadready',[ve])}):void 0}}(this)),se.__super__._init.call(this)},se.prototype.render=function(){let pe;if(pe=1<=arguments.length?le.call(arguments,0):[],se.__super__.render.apply(this,pe),this.popover=new R({button:this}),'upload'===this.editor.opts.imageButton)return this._initUploader(this.el)},se.prototype.renderMenu=function(){return se.__super__.renderMenu.call(this),this._initUploader()},se.prototype._initUploader=function(pe){let ce,ue,ge;return(null==pe&&(pe=this.menuEl.find('.menu-item-upload-image')),null==this.editor.uploader)?void this.el.find('.btn-upload').remove():(ce=null,ue=function(he){return function(){return ce&&ce.remove(),ce=t('<input/>',{type:'file',title:he._t('uploadImage'),multiple:!0,accept:'image/gif,image/jpeg,image/jpg,image/png,image/svg'}).appendTo(pe)}}(this),ue(),pe.on('click mousedown','input[type=file]',function(he){return he.stopPropagation()}),pe.on('change','input[type=file]',function(he){return function(){return he.editor.inputManager.focused?(he.editor.uploader.upload(ce,{inline:!0}),ue()):(he.editor.one('focus',function(){return he.editor.uploader.upload(ce,{inline:!0}),ue()}),he.editor.focus()),he.wrapper.removeClass('menu-on')}}(this)),this.editor.uploader.on('beforeupload',function(he){return function(me,fe){let ye;if(fe.inline)return fe.img?ye=t(fe.img):(ye=he.createImage(fe.name),fe.img=ye),ye.addClass('uploading'),ye.data('file',fe),he.editor.uploader.readImageFile(fe.obj,function(_e){let be;if(ye.hasClass('uploading'))return be=_e?_e.src:he.defaultImage,he.loadImage(ye,be,function(){if(he.popover.active)return he.popover.refresh(),he.popover.srcEl.val(he._t('uploading')).prop('disabled',!0)})})}}(this)),ge=t.proxy(this.editor.util.throttle(function(he,me,fe,ye){let _e,be,ve;if(me.inline)return(be=me.img.data('mask'),!!be)?(_e=be.data('img'),!(_e.hasClass('uploading')&&0<_e.parent().length))?void be.remove():(ve=fe/ye,ve=(100*ve).toFixed(0),99<ve&&(ve=99),be.find('.progress').height(100-ve+'%')):void 0},500),this),this.editor.uploader.on('uploadprogress',ge),this.editor.uploader.on('uploadsuccess',function(he){return function(me,fe,ye){let _e,be,ve;if(fe.inline&&(_e=fe.img,!!(_e.hasClass('uploading')&&0<_e.parent().length))){if('object'!=typeof ye)try{ye=t.parseJSON(ye)}catch(we){me=we,ye={success:!1}}if(!1===ye.success){ve=ye.msg||he._t('uploadFailed'),alert(ve),_e.removeData('file'),_e.removeClass('uploading').removeClass('loading');let we;return we=_e.data('mask'),we&&we.remove(),_e.removeData('mask'),void _e.remove()}if(be=ye.respBody,he.loadImage(_e,be,function(){let we;if(_e.removeData('file'),_e.removeClass('uploading').removeClass('loading'),we=_e.data('mask'),we&&we.remove(),_e.removeData('mask'),he.editor.trigger('valuechanged'),1>he.editor.body.find('img.uploading').length)return he.editor.uploader.trigger('uploadready',[fe,ye])}),he.popover.active)return he.popover.srcEl.prop('disabled',!1),he.popover.srcEl.val(ye.respBody)}}}(this)),this.editor.uploader.on('uploaderror',function(he){return function(me,fe,ye){let _e,be,ve;if(fe.inline&&'abort'!==ye.statusText){if(ye.responseText)try{ve=t.parseJSON(ye.responseText),be=ve.msg}catch(xe){me=xe,be=he._t('uploadError')}if(_e=fe.img,!!(_e.hasClass('uploading')&&0<_e.parent().length)){alert('Internal server error!Cancelling image upload!');let we;return _e.removeData('file'),_e.removeClass('uploading').removeClass('loading'),we=_e.data('mask'),we&&we.remove(),_e.removeData('mask'),_e.remove(),null}}}}(this)))},se.prototype._status=function(){return this._disableStatus()},se.prototype.loadImage=function(pe,ce,ue){let ge,he,me;return me=function(fe){return function(){let ye,_e;return ye=pe.offset(),_e=fe.editor.wrapper.offset(),ge.css({top:ye.top-_e.top,left:ye.left-_e.left,width:pe.width(),height:pe.height()}).show()}}(this),pe.addClass('loading'),ge=pe.data('mask'),ge||(ge=t('<div class="simditor-image-loading">\n  <div class="progress"></div>\n</div>').hide().appendTo(this.editor.wrapper),me(),pe.data('mask',ge),ge.data('img',pe)),he=new Image,he.onload=function(fe){return function(){let ye,_e;if(pe.hasClass('loading')||pe.hasClass('uploading')){let be=fe.editor.body[0].clientWidth;if(be<=h?(_e=he.width>be?be:he.width,_e=_e>=u&&_e<=h?u:_e,ye=_e===u||_e===be?'auto':he.height):he.width>=h&&he.width<=be?(_e=u,ye='auto'):he.width<h&&(_e=he.width>=u?u:he.width,ye=_e===u?'auto':he.height),pe.attr({src:ce,width:_e,height:ye,'data-image-size':_e+','+ye}).removeClass('loading'),pe.hasClass('uploading')?(fe.editor.util.reflow(fe.editor.body),me()):(ge.remove(),pe.removeData('mask')),t.isFunction(ue))return ue(he)}}}(this),he.onerror=function(){return t.isFunction(ue)&&ue(!1),ge.remove(),pe.removeData('mask').removeClass('loading')},he.src=ce},se.prototype.createImage=function(pe){let ce,ue;return null==pe&&(pe='Image'),this.editor.inputManager.focused||this.editor.focus(),ue=this.editor.selection.range(),ue.deleteContents(),this.editor.selection.range(ue),ce=t('<img/>').attr('alt',pe),ue.insertNode(ce[0]),this.editor.selection.setRangeAfter(ce,ue),this.editor.trigger('valuechanged'),ce},se.prototype.command=function(pe){let ce;return ce=this.createImage(),this.loadImage(ce,pe||this.defaultImage,function(ue){return function(){return ue.editor.trigger('valuechanged'),ue.editor.util.reflow(ce),ce.click(),ue.popover.one('popovershow',function(){return ue.popover.srcEl.focus(),ue.popover.srcEl[0].select()})}}(this))},se}(v),R=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.offset={top:6,left:-4},se.prototype.render=function(){let pe;return pe='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t('imageUrl')+'</label>\n    <input class="image-src" type="text" tabindex="1" />\n    <a class="btn-upload" href="javascript:;"\n      title="'+this._t('uploadImage')+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-upload"></span>\n    </a>\n  </div>\n  <div class=\'settings-field\'>\n    <label>'+this._t('imageAlt')+'</label>\n    <input class="image-alt" id="image-alt" type="text" tabindex="1" />\n  </div>\n  <div class="settings-field">\n    <label>'+this._t('imageSize')+'</label>\n    <input class="image-size" id="image-width" type="text" tabindex="2" />\n    <span class="times">\xD7</span>\n    <input class="image-size" id="image-height" type="text" tabindex="3" />\n    <a class="btn-restore" href="javascript:;"\n      title="'+this._t('restoreImageSize')+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-undo"></span>\n    </a>\n  </div>\n</div>',this.el.addClass('image-popover').append(pe),this.srcEl=this.el.find('.image-src'),this.widthEl=this.el.find('#image-width'),this.heightEl=this.el.find('#image-height'),this.altEl=this.el.find('#image-alt'),this.srcEl.on('keydown',function(ce){return function(ue){let ge;if(!(13!==ue.which||ce.target.hasClass('uploading')))return ue.preventDefault(),ge=document.createRange(),ce.button.editor.selection.setRangeAfter(ce.target,ge),ce.hide()}}(this)),this.srcEl.on('blur',function(ce){return function(){return ce._loadImage(ce.srcEl.val())}}(this)),this.el.find('.image-size').on('blur',function(ce){return function(ue){return ce._resizeImg(t(ue.currentTarget)),ce.el.data('popover').refresh()}}(this)),this.el.find('.image-size').on('keyup',function(ce){return function(ue){let ge;if(ge=t(ue.currentTarget),13!==ue.which&&27!==ue.which&&9!==ue.which)return ce._resizeImg(ge,!0)}}(this)),this.el.find('.image-size').on('keydown',function(ce){return function(ue){let ge,he,me;return(he=t(ue.currentTarget),13===ue.which||27===ue.which)?(ue.preventDefault(),13===ue.which?ce._resizeImg(he):ce._restoreImg(),ge=ce.target,ce.hide(),me=document.createRange(),ce.button.editor.selection.setRangeAfter(ge,me)):9===ue.which?ce.el.data('popover').refresh():void 0}}(this)),this.altEl.on('keydown',function(ce){return function(ue){let ge;if(13===ue.which)return ue.preventDefault(),ge=document.createRange(),ce.button.editor.selection.setRangeAfter(ce.target,ge),ce.hide()}}(this)),this.altEl.on('keyup',function(ce){return function(ue){if(13!==ue.which&&27!==ue.which&&9!==ue.which)return ce.alt=ce.altEl.val(),ce.target.attr('alt',ce.alt)}}(this)),this.el.find('.btn-restore').on('click',function(ce){return function(){return ce._restoreImg(),ce.el.data('popover').refresh()}}(this)),this.editor.on('valuechanged',function(ce){return function(){if(ce.active)return ce.refresh()}}(this)),this._initUploader()},se.prototype._initUploader=function(){let pe,ce;return(pe=this.el.find('.btn-upload'),null==this.editor.uploader)?void pe.remove():(ce=function(ue){return function(){return ue.input&&ue.input.remove(),ue.input=t('<input/>',{type:'file',title:ue._t('uploadImage'),multiple:!0,accept:'image/gif,image/jpeg,image/jpg,image/png,image/svg'}).appendTo(pe)}}(this),ce(),this.el.on('click mousedown','input[type=file]',function(ue){return ue.stopPropagation()}),this.el.on('change','input[type=file]',function(ue){return function(){return ue.editor.uploader.upload(ue.input,{inline:!0,img:ue.target}),ce()}}(this)))},se.prototype._resizeImg=function(pe,ce){let ue,ge,he;if(null==ce&&(ce=!1),ge=1*pe.val(),!!(this.target&&(t.isNumeric(ge)||0>ge)))return(pe.is(this.widthEl)?(ge>=u&&(ge=u,this.widthEl.val(ge)),he=ge,ue=this.height*ge/this.width,this.heightEl.val(ue)):(ue=ge,he=this.width*ge/this.height,he>=u&&(he=u,ue=this.height*he/this.width,this.heightEl.val(ue)),this.widthEl.val(he)),!ce)?(this.target.attr({width:he,height:ue}),this.editor.trigger('valuechanged')):void 0},se.prototype._restoreImg=function(){let pe,ce;return ce=(null==(pe=this.target.data('image-size'))?void 0:pe.split(','))||[this.width,this.height],this.target.attr({width:1*ce[0],height:1*ce[1]}),this.widthEl.val(ce[0]),this.heightEl.val(ce[1]),this.editor.trigger('valuechanged')},se.prototype._loadImage=function(pe,ce){return /^data:image/.test(pe)&&!this.editor.uploader?void(ce&&ce(!1)):this.target.attr('src')===pe?void 0:this.button.loadImage(this.target,pe,function(ue){return function(ge){let he;if(ge&&(ue.active&&(ue.width=ge.width,ue.height=ge.height,ue.widthEl.val(ue.width),ue.heightEl.val(ue.height)),/^data:image/.test(pe)?(he=ue.editor.util.dataURLtoBlob(pe),he.name='Base64 Image.png',ue.editor.uploader.upload(he,{inline:!0,img:ue.target})):ue.editor.trigger('valuechanged'),ce))return ce(ge)}}(this))},se.prototype.show=function(){let pe,ce;return ce=1<=arguments.length?le.call(arguments,0):[],se.__super__.show.apply(this,ce),pe=this.target,this.width=pe.width(),this.height=pe.height(),this.alt=pe.attr('alt'),pe.hasClass('uploading')?this.srcEl.val(this._t('uploading')).prop('disabled',!0):(this.srcEl.val(pe.attr('src')).prop('disabled',!1),this.widthEl.val(this.width),this.heightEl.val(this.height),this.altEl.val(this.alt))},se}(V),K.Toolbar.addButton(B),I=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='indent',se.prototype.icon='indent',se.prototype._init=function(){let pe;return pe=!1===this.editor.opts.tabIndent?'':' (Tab)',this.title=this._t(this.name)+pe,se.__super__._init.call(this)},se.prototype._status=function(){},se.prototype.command=function(){return this.editor.indentation.indent()},se}(v),K.Toolbar.addButton(I),U=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='outdent',se.prototype.icon='outdent',se.prototype._init=function(){let pe;return pe=!1===this.editor.opts.tabIndent?'':' (Shift + Tab)',this.title=this._t(this.name)+pe,se.__super__._init.call(this)},se.prototype._status=function(){},se.prototype.command=function(){return this.editor.indentation.indent(!0)},se}(v),K.Toolbar.addButton(U),E=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='hr',se.prototype.icon='minus',se.prototype.htmlTag='hr',se.prototype._status=function(){},se.prototype.command=function(){let pe,ce,ue,ge;return ge=this.editor.selection.rootNodes().first(),ue=ge.next(),0<ue.length?this.editor.selection.save():ce=t('<p/>').append(this.editor.util.phBr),pe=t('<hr/>').insertAfter(ge),ce?(ce.insertAfter(pe),this.editor.selection.setRangeAtStartOf(ce)):this.editor.selection.restore(),this.editor.trigger('valuechanged')},se}(v),K.Toolbar.addButton(E),J=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='table',se.prototype.icon='table',se.prototype.htmlTag='table',se.prototype.disableTag='pre, li, blockquote',se.prototype.menu=!0,se.prototype._init=function(){return se.__super__._init.call(this),t.merge(this.editor.formatter._allowedTags,['thead','th','tbody','tr','td','colgroup','col']),t.extend(this.editor.formatter._allowedAttributes,{td:['rowspan','colspan'],col:['width']}),t.extend(this.editor.formatter._allowedStyles,{td:['text-align'],th:['text-align']}),this._initShortcuts(),this._initResize(),this.editor.on('decorate',function(pe){return function(ce,ue){return ue.find('table').each(function(ge,he){return pe.decorate(t(he))})}}(this)),this.editor.on('undecorate',function(pe){return function(ce,ue){return ue.find('table').each(function(ge,he){return pe.undecorate(t(he))})}}(this)),this.editor.on('selectionchanged.table',function(pe){return function(){let ue,ge;if(pe.editor.body.find('.simditor-table td, .simditor-table th').removeClass('active'),ge=pe.editor.selection.range(),!!ge)return ue=pe.editor.selection.containerNode(),ge.collapsed&&ue.is('.simditor-table')&&pe.editor.selection.setRangeAtEndOf(ue),ue.closest('td, th',pe.editor.body).addClass('active')}}(this)),this.editor.on('blur.table',function(pe){return function(){return pe.editor.body.find('.simditor-table td, .simditor-table th').removeClass('active')}}(this)),this.editor.keystroke.add('up','td',function(pe){return function(ce,ue){return pe._tdNav(ue,'up'),!0}}(this)),this.editor.keystroke.add('up','th',function(pe){return function(ce,ue){return pe._tdNav(ue,'up'),!0}}(this)),this.editor.keystroke.add('down','td',function(pe){return function(ce,ue){return pe._tdNav(ue,'down'),!0}}(this)),this.editor.keystroke.add('down','th',function(pe){return function(ce,ue){return pe._tdNav(ue,'down'),!0}}(this))},se.prototype._tdNav=function(pe,ce){let ue,ge,he,me,fe,ye,_e;return(null==ce&&(ce='up'),he='up'===ce?'prev':'next',_e='up'===ce?['tbody','thead']:['thead','tbody'],ye=_e[0],me=_e[1],ge=pe.parent('tr'),ue=this['_'+he+'Row'](ge),!!!(0<ue.length))||(fe=ge.find('td, th').index(pe),this.editor.selection.setRangeAtEndOf(ue.find('td, th').eq(fe)))},se.prototype._nextRow=function(pe){let ce;return ce=pe.next('tr'),1>ce.length&&0<pe.parent('thead').length&&(ce=pe.parent('thead').next('tbody').find('tr:first')),ce},se.prototype._prevRow=function(pe){let ce;return ce=pe.prev('tr'),1>ce.length&&0<pe.parent('tbody').length&&(ce=pe.parent('tbody').prev('thead').find('tr')),ce},se.prototype._initResize=function(){let pe;return pe=this.editor,t(document).on('mousemove.simditor-table','.simditor-table td, .simditor-table th',function(ce){let ue,ge,he,me,fe,ye,_e,be,ve;if(fe=t(this).parents('.simditor-table'),he=fe.find('.simditor-resize-handle'),ge=fe.find('colgroup'),!fe.hasClass('resizing'))return(me=t(ce.currentTarget),ve=ce.pageX-t(ce.currentTarget).offset().left,5>ve&&0<me.prev().length&&(me=me.prev()),1>me.next('td, th').length)?void he.hide():(null==(_e=he.data('td'))?void 0:_e.is(me))?void he.show():(ye=me.parent().find('td, th').index(me),ue=ge.find('col').eq(ye),(null==(be=he.data('col'))?void 0:be.is(ue))?void he.show():he.css('left',me.position().left+me.outerWidth()-5).data('td',me).data('col',ue).show())}),t(document).on('mouseleave.simditor-table','.simditor-table',function(){return t(this).find('.simditor-resize-handle').hide()}),t(document).on('mousedown.simditor-resize-handle','.simditor-resize-handle',function(ce){let ue,ge,he,me,fe,ye,_e,be,ve,we,xe,ke;return ye=t(this).parent('.simditor-table'),ue=t(ce.currentTarget),he=ue.data('td'),ge=ue.data('col'),fe=he.next('td, th'),me=ge.next('col'),xe=ce.pageX,ve=1*he.outerWidth(),we=1*fe.outerWidth(),be=parseFloat(ue.css('left')),ke=he.closest('table').width(),_e=50,t(document).on('mousemove.simditor-resize-table',function(Ce){let Te,Ne,Se;return Te=Ce.pageX-xe,Ne=ve+Te,Se=we-Te,Ne<_e?(Ne=_e,Te=_e-ve,Se=we-Te):Se<_e&&(Se=_e,Te=we-_e,Ne=ve+Te),ge.attr('width',100*(Ne/ke)+'%'),me.attr('width',100*(Se/ke)+'%'),ue.css('left',be+Te)}),t(document).one('mouseup.simditor-resize-table',function(){return pe.sync(),t(document).off('.simditor-resize-table'),ye.removeClass('resizing')}),ye.addClass('resizing'),!1})},se.prototype._initShortcuts=function(){return this.editor.hotkeys.add('ctrl+alt+up',function(pe){return function(){return pe.editMenu.find('.menu-item[data-param=insertRowAbove]').click(),!1}}(this)),this.editor.hotkeys.add('ctrl+alt+down',function(pe){return function(){return pe.editMenu.find('.menu-item[data-param=insertRowBelow]').click(),!1}}(this)),this.editor.hotkeys.add('ctrl+alt+left',function(pe){return function(){return pe.editMenu.find('.menu-item[data-param=insertColLeft]').click(),!1}}(this)),this.editor.hotkeys.add('ctrl+alt+right',function(pe){return function(){return pe.editMenu.find('.menu-item[data-param=insertColRight]').click(),!1}}(this))},se.prototype.decorate=function(pe){let ce,ue,ge,he,me,fe;return 0<pe.parent('.simditor-table').length&&this.undecorate(pe),pe.wrap('<div class="simditor-table"></div>'),fe=pe.parent('.simditor-table'),ce=pe.find('colgroup'),1>pe.find('thead').length&&(me=t('<thead />'),ue=pe.find('tr').first(),me.append(ue),this._changeCellTag(ue,'th'),he=pe.find('tbody'),0<he.length?he.before(me):pe.prepend(me)),1>ce.length&&(ce=t('<colgroup/>').prependTo(pe),pe.find('thead tr th').each(function(){let be;return be=t('<col/>').appendTo(ce)}),this.refreshTableWidth(pe)),ge=t('<div />',{'class':'simditor-resize-handle',contenteditable:'false'}).appendTo(fe),pe.parent()},se.prototype.undecorate=function(pe){return 0<pe.parent('.simditor-table').length?pe.parent().replaceWith(pe):void 0},se.prototype.renderMenu=function(){let pe;return t('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteRow">\n        <span>'+this._t('deleteRow')+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowAbove">\n        <span>'+this._t('insertRowAbove')+' ( Ctrl + Alt + \u2191 )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowBelow">\n        <span>'+this._t('insertRowBelow')+' ( Ctrl + Alt + \u2193 )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteCol">\n        <span>'+this._t('deleteColumn')+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColLeft">\n        <span>'+this._t('insertColumnLeft')+' ( Ctrl + Alt + \u2190 )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColRight">\n        <span>'+this._t('insertColumnRight')+' ( Ctrl + Alt + \u2192 )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteTable">\n        <span>'+this._t('deleteTable')+'</span>\n      </a>\n    </li>\n  </ul>\n</div>').appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find('.menu-create-table'),this.editMenu=this.menuWrapper.find('.menu-edit-table'),pe=this.createTable(6,6).appendTo(this.createMenu),this.createMenu.on('mouseenter','td, th',function(ce){return function(ue){let ge,he,me,fe;return ce.createMenu.find('td, th').removeClass('selected'),ge=t(ue.currentTarget),he=ge.parent(),fe=he.find('td, th').index(ge)+1,me=he.prevAll('tr').addBack(),he.parent().is('tbody')&&(me=me.add(pe.find('thead tr'))),me.find('td:lt('+fe+'), th:lt('+fe+')').addClass('selected')}}(this)),this.createMenu.on('mouseleave',function(ce){return t(ce.currentTarget).find('td, th').removeClass('selected')}),this.createMenu.on('mousedown','td, th',function(ce){return function(ue){let ge,he,me,fe,ye;if(ce.wrapper.removeClass('menu-on'),!!ce.editor.inputManager.focused)return he=t(ue.currentTarget),me=he.parent(),fe=me.find('td').index(he)+1,ye=me.prevAll('tr').length+1,me.parent().is('tbody')&&(ye+=1),pe=ce.createTable(ye,fe,!0),ge=ce.editor.selection.blockNodes().last(),ce.editor.util.isEmptyNode(ge)?ge.replaceWith(pe):ge.after(pe),ce.decorate(pe),ce.editor.selection.setRangeAtStartOf(pe.find('th:first')),ce.editor.trigger('valuechanged'),!1}}(this))},se.prototype.createTable=function(pe,ce,ue){let ge,he,me,fe,ye,_e,be,ve,we,xe,ke;for(ge=t('<table/>'),fe=t('<thead/>').appendTo(ge),he=t('<tbody/>').appendTo(ge),(we=be=0,xe=pe);0<=xe?be<xe:be>xe;we=0<=xe?++be:--be)for(ye=t('<tr/>'),ye.appendTo(0===we?fe:he),(_e=ve=0,ke=ce);0<=ke?ve<ke:ve>ke;_e=0<=ke?++ve:--ve)me=t(0===we?'<th/>':'<td/>').appendTo(ye),ue&&me.append(this.editor.util.phBr);return ge},se.prototype.refreshTableWidth=function(pe){return setTimeout(function(){return function(){let ue,ge;return ge=pe.width(),ue=pe.find('col'),pe.find('thead tr th').each(function(he,me){let fe;return fe=ue.eq(he),fe.attr('width',100*(t(me).outerWidth()/ge)+'%')})}}(this),0)},se.prototype.setActive=function(pe){return se.__super__.setActive.call(this,pe),pe?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())},se.prototype._changeCellTag=function(pe,ce){return pe.find('td, th').each(function(ue,ge){let he;return he=t(ge),he.replaceWith('<'+ce+'>'+he.html()+'</'+ce+'>')})},se.prototype.deleteRow=function(pe){let ce,ue,ge;return ue=pe.parent('tr'),1>ue.closest('table').find('tr').length?this.deleteTable(pe):(ce=this._nextRow(ue),0<ce.length||(ce=this._prevRow(ue)),ge=ue.find('td, th').index(pe),ue.parent().is('thead')&&(ce.appendTo(ue.parent()),this._changeCellTag(ce,'th')),ue.remove(),this.editor.selection.setRangeAtEndOf(ce.find('td, th').eq(ge)))},se.prototype.insertRow=function(pe,ce){let ue,ge,he,me,fe,ye,_e,be,ve;for(null==ce&&(ce='after'),he=pe.parent('tr'),ge=he.closest('table'),fe=0,ge.find('tr').each(function(we,xe){return fe=Math.max(fe,t(xe).find('td').length)}),_e=he.find('td, th').index(pe),ue=t('<tr/>'),me='td','after'===ce&&he.parent().is('thead')?he.parent().next('tbody').prepend(ue):'before'===ce&&he.parent().is('thead')?(he.before(ue),he.parent().next('tbody').prepend(he),this._changeCellTag(he,'td'),me='th'):he[ce](ue),(ye=be=1,ve=fe);1<=ve?be<=ve:be>=ve;ye=1<=ve?++be:--be)t('<'+me+'/>').append(this.editor.util.phBr).appendTo(ue);return this.editor.selection.setRangeAtStartOf(ue.find('td, th').eq(_e))},se.prototype.deleteCol=function(pe){let ce,ue,ge,he,me,fe;return ge=pe.parent('tr'),fe=2>ge.closest('table').find('tr').length,me=1>pe.siblings('td, th').length,fe&&me?this.deleteTable(pe):(he=ge.find('td, th').index(pe),ce=pe.next('td, th'),0<ce.length||(ce=ge.prev('td, th')),ue=ge.closest('table'),ue.find('col').eq(he).remove(),ue.find('tr').each(function(ye,_e){return t(_e).find('td, th').eq(he).remove()}),this.refreshTableWidth(ue),this.editor.selection.setRangeAtEndOf(ce))},se.prototype.insertCol=function(pe,ce){let ue,ge,he,me,fe,ye,_e,be;return null==ce&&(ce='after'),fe=pe.parent('tr'),ye=fe.find('td, th').index(pe),me=pe.closest('table'),ue=me.find('col').eq(ye),me.find('tr').each(function(ve){return function(we,xe){let ke,Ce;return Ce=t(xe).parent().is('thead')?'th':'td',ke=t('<'+Ce+'/>').append(ve.editor.util.phBr),t(xe).find('td, th').eq(ye)[ce](ke)}}(this)),ge=t('<col/>'),ue[ce](ge),_e=me.width(),be=Math.max(parseFloat(ue.attr('width'))/2,100*(50/_e)),ue.attr('width',be+'%'),ge.attr('width',be+'%'),this.refreshTableWidth(me),he='after'===ce?pe.next('td, th'):pe.prev('td, th'),this.editor.selection.setRangeAtStartOf(he)},se.prototype.deleteTable=function(pe){let ce,ue;if(ue=pe.closest('.simditor-table'),ce=ue.next('p'),ue.remove(),0<ce.length)return this.editor.selection.setRangeAtStartOf(ce)},se.prototype.command=function(pe){let ce;if(ce=this.editor.selection.containerNode().closest('td, th'),!!(0<ce.length)){if('deleteRow'===pe)this.deleteRow(ce);else if('insertRowAbove'===pe)this.insertRow(ce,'before');else if('insertRowBelow'===pe)this.insertRow(ce);else if('deleteCol'===pe)this.deleteCol(ce);else if('insertColLeft'===pe)this.insertCol(ce,'before');else if('insertColRight'===pe)this.insertCol(ce);else if('deleteTable'===pe)this.deleteTable(ce);else return;return this.editor.trigger('valuechanged')}},se}(v),K.Toolbar.addButton(J),X=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='strikethrough',se.prototype.icon='strikethrough',se.prototype.htmlTag='strike',se.prototype.disableTag='pre',se.prototype._activeStatus=function(){let pe;return pe=!0===document.queryCommandState('strikethrough'),this.setActive(pe),this.active},se.prototype.command=function(){return document.execCommand('strikethrough'),this.editor.util.support.oninput||this.editor.trigger('valuechanged'),t(document).trigger('selectionchange')},se}(v),K.Toolbar.addButton(X),f=function(de){function se(){return se.__super__.constructor.apply(this,arguments)}return oe(se,de),se.prototype.name='alignment',se.prototype.icon='align-left',se.prototype.htmlTag='p, h1, h2, h3, h4, td, th',se.prototype._init=function(){return this.menu=[{name:'left',text:this._t('alignLeft'),icon:'align-left',param:'left'},{name:'center',text:this._t('alignCenter'),icon:'align-center',param:'center'},{name:'right',text:this._t('alignRight'),icon:'align-right',param:'right'}],se.__super__._init.call(this)},se.prototype.setActive=function(pe,ce){return null==ce&&(ce='left'),'left'!==ce&&'center'!==ce&&'right'!==ce&&(ce='left'),'left'===ce?se.__super__.setActive.call(this,!1):se.__super__.setActive.call(this,pe),this.el.removeClass('align-left align-center align-right'),pe&&this.el.addClass('align-'+ce),this.setIcon('align-'+ce),this.menuEl.find('.menu-item').show().end().find('.menu-item-'+ce).hide()},se.prototype._status=function(){return this.nodes=this.editor.selection.nodes().filter(this.htmlTag),1>this.nodes.length?(this.setDisabled(!0),this.setActive(!1)):(this.setDisabled(!1),this.setActive(!0,this.nodes.first().css('text-align')))},se.prototype.command=function(pe){if('left'!==pe&&'center'!==pe&&'right'!==pe)throw new Error('simditor alignment button: invalid align '+pe);return this.nodes.css({'text-align':'left'===pe?'':pe}),this.editor.trigger('valuechanged'),this.editor.inputManager.throttledSelectionChanged()},se}(v),K.Toolbar.addButton(f),K});