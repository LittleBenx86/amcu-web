!function(s,e){"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(s.jQuery)}(this,function(y){var i=function(s,e){this.options=e,this.$element="",this.language=t[this.options.locale],this.uploadList=[],this.totalProgress=[],this.toUpload=[],this.imgNames=[],this.totalFilesLength=0,this.successfulUpload=0,this.aborted=0,this.abortedWithError=0,this.pending=0,this.inProgress=0,this.currentListLength=0,this.init(s)};i.prototype.init=function(s){y(s).addClass("ssi-uploadInput").after(this.$element=y('<div class="ssi-uploader">'));var o,e=y('<span class="ssi-InputLabel"><button class="ssi-button success">'+this.language.chooseFiles+"</button></span>").append(s),n=y('<button id="ssi-uploadBtn" class="ssi-button success ssi-hidden" ><span class="ssi-btnIn">'+this.language.upload+'&nbsp;</span><div id="ssi-up_loading" class="ssi-btnIn"></div></button>'),a=y('<button id="ssi-clearBtn" class="ssi-hidden ssi-button info" >'+this.language.clear+"</button>"),t=y('<button id="ssi-abortBtn" class="ssi-button error ssi-cancelAll ssi-hidden" ><span class="inBtn">'+this.language.abort+" </span></button>");if(this.$element.append(y('<div class="ssi-buttonWrapper">').append(e,t,n,a)),this.options.preview)o=y('<div id="ssi-previewBox" class="ssi-uploadBox ssi-previewBox '+(this.options.dropZone?'ssi-dropZonePreview ssi-dropZone"><div id="ssi-DropZoneBack">'+this.language.drag+"</div>":'">')+"</div>"),this.$element.append(o);else{this.$element.addClass("ssi-uploaderNP");var i=y('<table id="ssi-fileList" class="ssi-fileList"></table>'),r=y('<span class="ssi-namePreview"></span>'),l=y('<div id="ssi-uploadFiles" class="ssi-tooltip ssi-uploadFiles '+(this.options.dropZone?"ssi-dropZone":"")+'"><div id="ssi-uploadProgressNoPreview" class="ssi-uploadProgressNoPreview"></div></div>').append(r),d=y('<div class="ssi-uploadDetails"></div>').append(i);o=y('<div class="ssi-uploadBoxWrapper ssi-uploadBox"></div>').append(l,d),this.$element.prepend(o)}var p,u=this,c=e.find(".ssi-uploadInput");e.find("button").click(function(){c.trigger("click")}),c.on("change",function(){u.toUploadFiles(this.files),c.val("")}),u.options.dropZone&&(o.on("drop",function(s){s.preventDefault(),o.removeClass("ssi-dragOver");var e=s.originalEvent.dataTransfer.files;u.toUploadFiles(e)}),o.on("dragover",function(s){return s.preventDefault(),o.addClass("ssi-dragOver"),!1}),o.on("dragleave",function(s){return s.preventDefault(),o.removeClass("ssi-dragOver"),!1})),u.options.preview||l.click(function(){1<u.currentListLength&&d.toggleClass("ssi-uploadBoxOpened")}),a.click(function(){u.clear()}),o.on("mouseenter",".ssi-statusLabel",function(s){var e=y(s.currentTarget),t=e.attr("data-status");if(t&&""!==t){var i="35";e.hasClass("ssi-noPreviewSubMessage")&&(i=0),p=y('<div class="ssi-infoTooltip">'+t+"</div>").appendTo(u.$element).css({top:e.position().top-i,left:e.position().left-5}).fadeIn("slow")}}),o.on("mouseleave",".ssi-statusLabel",function(){p&&p.remove()}),o.on("click",".ssi-removeBtn",function(s){var e=y(s.currentTarget),t=e.data("delete");if(u.pending--,u.currentListLength--,0===u.pending&&n.prop("disabled",!0),u.options.preview)e.parents("table.ssi-imgToUploadTable").remove();else{var i=e.parents("tr.ssi-toUploadTr");r.html(u.currentListLength+" files"),i.prev().remove(),i.remove(),1===u.currentListLength&&h(u)}u.toUpload[t]=null,u.imgNames[t]=null,0===u.currentListLength&&(u.options.dropZone||o.removeClass("ssi-uploadNoDropZone"),a.addClass("ssi-hidden"),n.addClass("ssi-hidden"))}),o.on("click",".ssi-abortUpload",function(s){var e=y(s.currentTarget).data("delete");u.abort(e)}),n.click(function(){u.uploadFiles()}),t.click(function(){u.abortAll()})},i.prototype.abortAll=function(){for(var s=0;s<this.uploadList.length;s++)"object"==typeof this.uploadList[s]&&this.abort(s)},i.prototype.toUploadFiles=function(s){if(!("number"==typeof this.options.maxNumberOfFiles&&this.inProgress+this.pending>=this.options.maxNumberOfFiles)){var e,a=this,r=0,l="",d=this.$element.find("#ssi-uploadBtn"),p=this.$element.find("#ssi-clearBtn"),u=this.$element.find("#ssi-fileList"),c=this.$element.find(".ssi-uploadBox"),h=[];0===this.inProgress&&0===this.pending&&this.clear();var g,t=[],i=[],o="",n=e=g=s.length;"number"==typeof this.options.maxNumberOfFiles&&n>this.options.maxNumberOfFiles-(this.inProgress+this.pending)&&(n=g=this.options.maxNumberOfFiles-(this.inProgress+this.pending));for(var f=0;f<n;f++){var v=s[f],m=v.name.getExtension();-1===y.inArray(m,this.options.allowed)?(n<e?n++:g--,-1===y.inArray(m,t)&&t.push(m)):(v.size*Math.pow(10,-6)).toFixed(2)>this.options.maxFileSize?(n<e?n++:g--,i.push(P(v.name,m,15))):-1===y.inArray(v.name,this.imgNames)?(d.prop("disabled",!1),L(),this.pending++,this.currentListLength++):n<e?n++:g--}var b=t.length,U=i.length;0<b+U&&(0<b&&(o=this.language.extError.replaceText(t.toString().replace(/,/g,", "))),0<U&&(o+=this.language.sizeError.replaceText(i.toString().replace(/,/g,", "),this.options.maxFileSize+"mb")),this.options.errorHandler.method(o,this.options.errorHandler.error))}function L(){var e=a.totalFilesLength+a.pending;0===e&&(a.options.preview&&(a.options.dropZone||c.addClass("ssi-uploadNoDropZone")),d.removeClass("ssi-hidden"),p.removeClass("ssi-hidden")),p.prop("disabled",!1);var t=(a.toUpload[e]=v).name,i=t.getExtension();if(a.imgNames[e]=t,a.options.preview){var s=function(s){return'<table class="ssi-imgToUploadTable ssi-pending"><tr><td class="ssi-upImgTd">'+s+'</td></tr><tr><td><div id="ssi-uploadProgress'+e+'" class="ssi-hidden ssi-uploadProgress"></div></td></tr><tr><td><button data-delete="'+e+'" class=" ssi-button error ssi-removeBtn"><span class="trash10 trash"></span></button></td></tr><tr><td>'+P(t,i,15)+"</td></tr></table>"};if("image"==v.type.split("/")[0]){d.prop("disabled",!0),p.prop("disabled",!0);var o=new FileReader;o.onload=function(){l+=s('<img class="ssi-imgToUpload" src=""/><i class="fa-spin fa fa-spinner fa-pulse"></i>'),h[e]=o.result,g===++r&&(c.append(l),d.prop("disabled",!1),p.prop("disabled",!1),setTimeout(function(){n()},10),l="",g=[])},o.readAsDataURL(v)}else h[e]=null,c.append(s('<div class="document-item" href="test.mov" filetype="'+i+'"><span class = "fileCorner"></span></div>')),r++}else a.$element.find(".ssi-namePreview").html(0===e?P(t,i,13):a.currentListLength+1+" "+a.language.files),u.append('<tr class="ssi-space"><td></td></tr><tr class="ssi-toUploadTr ssi-pending"><td><div id="ssi-uploadProgress'+e+'" class="ssi-hidden ssi-uploadProgress ssi-uploadProgressNoPre"></div><span>'+P(t,i,20)+'</span></td><td><a data-delete="'+e+'" class="ssi-button ssi-removeBtn  ssi-removeBtnNP"><span class="trash7 trash"></span></a></td></tr>');var n=function(){for(var s=0;s<h.length;s++)null!==h[s]&&(c.find("#ssi-uploadProgress"+s).parents("table.ssi-imgToUploadTable").find(".ssi-imgToUpload").attr("src",h[s]).next().remove(),h[s]=null);h=[]}}};var o=function(s){var e=s.$element.find(".ssi-completed");s.successfulUpload=0,s.aborted=0,s.abortedWithError=0,s.options.preview||e.prev("tr").remove(),e.remove()},n=function(s){for(var e=s.$element.find(".ssi-pending"),t=s.imgNames.length,i=0;i<t;i++)null===s.imgNames[i]&&(s.toUpload.splice(i,1),s.imgNames.splice(i,1));s.toUpload.splice(-s.pending,s.pending),s.imgNames.splice(-s.pending,s.pending),s.pending=0,s.options.preview||e.prev("tr").remove(),e.remove()};i.prototype.clear=function(s){switch(s){case"pending":n(this);break;case"completed":o(this);break;default:n(this),o(this)}var e=this.$element.find("#ssi-uploadBtn"),t=this.$element.find("#ssi-clearBtn");this.currentListLength=r(this),0===this.inProgress&&(this.totalProgress=[]),0===this.currentListLength&&(t.addClass("ssi-hidden"),e.addClass("ssi-hidden"),this.totalFilesLength=0,this.options.dropZone||this.$element.find(".ssi-uploadBox").removeClass("ssi-uploadNoDropZone")),t.prop("disabled",!0),e.prop("disabled",!0),this.options.preview||a(this)};var a=function(s){1<s.currentListLength?s.$element.find(".ssi-namePreview").html(s.currentListLength+" files"):1===s.currentListLength?h(s):(s.$element.find(".ssi-uploadDetails").removeClass("ssi-uploadBoxOpened"),s.$element.find("#ssi-fileList").empty(),s.$element.find(".ssi-namePreview").empty())};i.prototype.uploadFiles=function(){if(0<this.pending){this.$element.find("#ssi-abortBtn").removeClass("ssi-hidden"),this.$element.find(".ssi-removeBtn").addClass("ssi-abortUpload").removeClass("ssi-removeBtn").children("span").removeClass("trash7 trash10 trash").addClass(this.options.preview?"ban7w":"ban7");var o=this.$element.find("#ssi-uploadBtn"),c=this.$element.find("#ssi-clearBtn");o.prop("disabled",!0);var h=this,t=new FormData,n=this.totalFilesLength;for(0===this.totalFilesLength||this.options.preview||a(this),this.inProgress+=this.pending,this.totalFilesLength+=this.pending,this.pending=0,this.inProgress===this.currentListLength&&c.prop("disabled",!0);null===this.toUpload[n];)n++;if(t.append("file",h.toUpload[n]),y.each(this.options.data,function(s,e){t.append(s,e)}),"function"==typeof this.options.beforeUpload)try{this.options.beforeUpload()}catch(s){return console.log("There is an error in beforeUpload callback"),console.log(s),void h.abortAll()}h.$element.find("input.ssi-uploadInput").trigger("beforeUpload.ssi-uploader"),function s(t,p){var e="table.ssi-imgToUploadTable";h.options.preview||(e="tr.ssi-toUploadTr");var u=h.$element.find("#ssi-uploadProgress"+p);u.removeClass("ssi-hidden").parents(e).removeClass("ssi-pending");var i=y.extend({},{xhr:function(){var s=new window.XMLHttpRequest;return s.upload.addEventListener("progress",function(s){if(s.lengthComputable){var e=s.loaded/s.total*100;u&&u.css({width:e+"%"}),h.totalProgress[p]=e;var t=d(h.totalProgress)/(h.inProgress+h.successfulUpload);h.options.preview||h.$element.find("#ssi-uploadProgressNoPreview").removeClass("ssi-hidden").css({width:t+"%"}),o.find("#ssi-up_loading").html(Math.ceil(t)+"%")}},!1),s},async:!0,beforeSend:function(s){if(h.uploadList[p]=s,o.find("#ssi-up_loading").html('<i class="fa fa-spinner fa-pulse"></i>'),"function"==typeof h.options.beforeEachUpload)try{var e=h.options.beforeEachUpload({name:h.toUpload[p].name,type:h.toUpload[p].type,size:(h.toUpload[p].size/1024).toFixed(2)},s)}catch(s){return console.log("There is an error in beforeEachUpload callback"),console.log(s),void h.abortAll()}h.$element.find("input.ssi-uploadInput").trigger("beforeEachUpload.ssi-uploader"),0===s.status&&"canceled"===s.statusText&&(void 0===e&&(e=!1),h.abortedWithError++,h.abort(p,e))},type:"POST",data:t,cache:!1,contentType:!1,processData:!1,url:h.options.url,error:function(s,e){if("abort"!==e){u.addClass("ssi-canceledProgressBar");var t=h.language.error;if(h.abortedWithError++,h.totalProgress.splice(p,1),h.options.preview||(t='<span class="exclamation7"></span>'),g(h,p,"error",t,h.language.serverError),h.totalProgress[p]="",h.inProgress--,c.prop("disabled",!1),"function"==typeof h.options.onEachUpload)try{h.options.onEachUpload({uploadStatus:"error",name:h.toUpload[p].name,size:(h.toUpload[p].size/1024).toFixed(2),type:h.toUpload[p].type})}catch(s){console.log("There is an error in onEachUpload callback"),console.log(s)}f(h)&&v(h),console.log(arguments),console.log(" Ajax error: "+e)}}},h.options.ajaxOptions);y.ajax(i).done(function(e,s,t){var i,o,n="",a="error",r="exclamation";try{o=y.parseJSON(e)}catch(s){o=e}if(h.options.responseValidation){var l=h.options.responseValidation;"object"==typeof l.validationKey&&"validationKey"==l.resultKey?o.hasOwnProperty(l.validationKey.success)?d(!0):d(!1,o[l.validationKey.error]):o[l.validationKey]==l.success?d(!0):d(!1,o[l.resultKey])}else 200==t.status?d(!0):d(!1,o);function d(s,e){s?(a="success",i=h.language.success,r="check",h.successfulUpload++):(u.addClass("ssi-canceledProgressBar"),h.options.preview&&(i=h.language.error),n=e,h.abortedWithError++)}if(h.options.preview||(i='<span class="'+r+'7"></span>'),g(h,p,a,i,n),"function"==typeof h.options.onEachUpload)try{h.options.onEachUpload({uploadStatus:a,name:h.toUpload[p].name,size:(h.toUpload[p].size/1024).toFixed(2),type:h.toUpload[p].type})}catch(s){console.log("There is an error in onEachUpload callback"),console.log(s)}h.$element.find("input.ssi-uploadInput").trigger("onEachUpload.ssi-uploader"),h.inProgress--,c.prop("disabled",!1),f(h)&&v(h),h.uploadList[p]="",h.toUpload[p]="",h.imgNames[p]=""});n=p;n++;for(;null===h.toUpload[n];)n++;n<h.toUpload.length&&(t=new FormData,y.each(h.options.data,function(s,e){t.append(s,e)}),t.append("file",h.toUpload[n]),s(t,n))}(t,n)}};var g=function(s,e,t,i,o){var n,a="",r="table.ssi-imgToUploadTable";s.options.preview||(a="ssi-noPreviewSubMessage",r="tr.ssi-toUploadTr",1===s.currentListLength&&(s.errors=o)),(n=s.$element.find(".ssi-abortUpload[data-delete='"+e+"']")).parents(r).addClass("ssi-completed"),n.after(l(t,i,o,a)).remove()},f=function(s){return 0===s.inProgress},l=function(s,e,t,i){return'<span class="ssi-statusLabel '+i+" "+s+'" data-status="'+t+'">'+e+"</span>"},r=function(s){return s.inProgress+s.successfulUpload+s.aborted+s.abortedWithError+s.pending},h=function(s){var e=s.$element.find("#ssi-fileList").find("span").html(),t=e.getExtension();s.$element.find(".ssi-uploadDetails").removeClass("ssi-uploadBoxOpened"),s.$element.find(".ssi-namePreview").html(P(e,t,15))};i.prototype.abort=function(s,e){void 0===e?(this.uploadList[s].abort(),this.totalProgress[s]="",e="Aborted",this.aborted++):"string"!=typeof e&&(e="");var t=this.language.aborted;this.options.preview||(t='<span class="ban7w"></span>'),g(this,s,"error",t,e),this.$element.find("#ssi-uploadProgress"+s).removeClass("ssi-hidden").addClass("ssi-canceledProgressBar"),this.toUpload[s]=void 0,this.uploadList[s]=void 0,this.imgNames[s]=void 0,this.$element.find("#ssi-clearBtn").prop("disabled",!1),this.inProgress--,f(this)&&v(this)};var v=function(s){if(s.$element.find("#ssi-abortBtn").addClass("ssi-hidden"),!s.options.preview){var e="error",t="",i="";0<s.abortedWithError?(t=1===s.totalFilesLength?s.errors:s.language.someErrorsOccurred,i='<span class="exclamation23"></span>'):0<s.aborted&&0===s.successfulUpload?(i='<span class="ban23"></span>',t=s.language.aborted):0<s.successfulUpload&&(e="success",i='<span class="check23"></span>',t=s.language.sucUpload),s.$element.find(".ssi-namePreview").append(l(e,i,t,"ssi-noPreviewMessage")),s.$element.find("#ssi-uploadProgressNoPreview").removeAttr("styles").addClass("ssi-hidden")}if("function"==typeof s.options.onUpload)try{s.options.onUpload()}catch(s){console.log("There is an error in onUpload callback"),console.log(s)}s.$element.find("input.ssi-uploadInput").trigger("onUpload.ssi-uploader");var o=s.$element.find("#ssi-uploadBtn");s.$element.find("#ssi-clearBtn").prop("disabled",!1),o.prop("disabled",!1).find("#ssi-up_loading").empty(),0===s.pending&&(o.addClass("ssi-hidden"),s.toUpload=[],s.imgNames=[],s.totalFilesLength=0),s.uploadList=[],s.totalProgress=[],s.currentListLength=r(s),s.successfulUpload=0,s.aborted=0,s.abortedWithError=0,s.inProgress=0};y.fn.ssi_uploader=function(s){var e={url:"",data:{},locale:"en",preview:!0,dropZone:!0,maxNumberOfFiles:"",responseValidation:!1,maxFileSize:2,ajaxOptions:{},onUpload:function(){},onEachUpload:function(){},beforeUpload:function(){},beforeEachUpload:function(){},allowed:["jpg","jpeg","png","bmp","gif"],errorHandler:{method:function(s){alert(s)},success:"success",error:"error"}},t=y.extend(!0,e,s);return this.each(function(){var s=y(this);if(s.is('input[type="file"]')){if(s.data("ssi_upload"))return;var e=new i(this,t);s.data("ssi_upload",e)}else console.log("The targeted element is not file input.")})},String.prototype.replaceText=function(){for(var s=Array.apply(null,arguments),e=this,t=0;t<s.length;t++)e=e.replace("$"+(t+1),s[t]);return e},String.prototype.getExtension=function(){return this.split(".").pop().toLowerCase()};var P=function(s,e,t){void 0===e&&(e=""),void 0===t&&(t=10);if(!(t<4)){var i=e.length;if(t<s.length-2){var o=(s=s.substring(0,t)).length-i;return(s=s.substring(0,o))+"..."+e}return s}},d=function(s){for(var e=0,t=0;t<s.length;t++)"number"==typeof s[t]&&(e+=s[t]);return e},t={en:{success:"Success",sucUpload:"Successful upload",chooseFiles:"Choose files",uploadFailed:"Upload failed",serverError:"Internal server error",error:"Error",abort:"Abort",aborted:"Aborted",files:"files",upload:"Upload",clear:"Clear",drag:"Drag n Drop",sizeError:"$1 exceed the size limit of $2",extError:"$1 file types are not supported",someErrorsOccurred:"Some errors occurred!"}}});